{"version":3,"file":"index.js","mappings":"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ApD;;;;;;;;;;ACAP;;AAEA;AACA;AACA;;AAEA,kBAAkB;AAClB,YAAY;AACZ,YAAY;AACZ,iBAAiB;AACjB,eAAe;AACf,eAAe;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,4CAA4C;;AAEvD;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,oDAAU;;AAEnC,OAAO,YAAY;;AAEnB;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;;;;;AC3QA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,mBAAO,CAAC,sCAAI;AACpC;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY,eAAe;AAC3B;AACA;AACA;AACA;;AAEA,kBAAkB,sBAAsB;AACxC;AACA,cAAc;AACd;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,uCAAuC;;AAEvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAI;AACJ;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,cAAc,SAAS;AACvB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,8CAA8C,SAAS;AACvD;AACA;AACA;AACA;;AAEA,8CAA8C,SAAS;AACvD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;;;;;;;;;ACjRA;AACA;AACA;AACA;;AAEA;AACA,CAAC,+FAAwC;AACzC,EAAE;AACF,CAAC,yFAAqC;AACtC;;;;;;;;;;;ACTA;AACA;AACA;;AAEA,YAAY,mBAAO,CAAC,gBAAK;AACzB,aAAa,mBAAO,CAAC,kBAAM;;AAE3B;AACA;AACA;;AAEA,YAAY;AACZ,WAAW;AACX,kBAAkB;AAClB,YAAY;AACZ,YAAY;AACZ,iBAAiB;AACjB,eAAe;AACf,SAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA,cAAc;;AAEd;AACA;AACA;AACA,uBAAuB,mBAAO,CAAC,8DAAgB;;AAE/C;AACA,EAAE,cAAc;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF,6DAA6D;AAC7D;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB;AACnB;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,CAAC,IAAI;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,4BAA4B;;AAEpC;AACA;AACA,iDAAiD,EAAE;AACnD,sBAAsB,WAAW,IAAI,MAAM;;AAE3C;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iBAAiB,iBAAiB;AAClC;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,oDAAU;;AAEnC,OAAO,YAAY;;AAEnB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACtQa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACPA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,eAAe;AAC1B,WAAW,QAAQ;AACnB,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACjKa;AACb,WAAW,mBAAO,CAAC,cAAI;AACvB,gBAAgB,mBAAO,CAAC,kDAAU;;AAElC;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iCAAiC,GAAG;AACpC;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClIA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D","sources":["webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/browser-action.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/commands.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/common.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/context-menus.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/cookies.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/notifications.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/runtime.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/tabs.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/web-navigation.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/api/windows.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/index.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/popup.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/router.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/store.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/browser/utils.ts","webpack://@lux-wallet/electron-chrome-extensions/./src/isomorphic/ipc.ts","webpack://@lux-wallet/electron-chrome-extensions/./node_modules/debug/src/browser.js","webpack://@lux-wallet/electron-chrome-extensions/./node_modules/debug/src/common.js","webpack://@lux-wallet/electron-chrome-extensions/./node_modules/debug/src/index.js","webpack://@lux-wallet/electron-chrome-extensions/./node_modules/debug/src/node.js","webpack://@lux-wallet/electron-chrome-extensions/./node_modules/has-flag/index.js","webpack://@lux-wallet/electron-chrome-extensions/./node_modules/ms/index.js","webpack://@lux-wallet/electron-chrome-extensions/./node_modules/supports-color/index.js","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"electron\"","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"events\"","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"fs\"","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"node:path\"","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"node:url\"","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"os\"","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"path\"","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"tty\"","webpack://@lux-wallet/electron-chrome-extensions/external node-commonjs \"util\"","webpack://@lux-wallet/electron-chrome-extensions/webpack/bootstrap","webpack://@lux-wallet/electron-chrome-extensions/webpack/runtime/compat get default export","webpack://@lux-wallet/electron-chrome-extensions/webpack/runtime/define property getters","webpack://@lux-wallet/electron-chrome-extensions/webpack/runtime/hasOwnProperty shorthand","webpack://@lux-wallet/electron-chrome-extensions/webpack/runtime/make namespace object","webpack://@lux-wallet/electron-chrome-extensions/./src/index.ts"],"sourcesContent":["import { Menu, MenuItem, protocol, nativeImage, app } from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { PopupView } from '../popup'\r\nimport { ExtensionEvent } from '../router'\r\nimport {\r\n  getExtensionUrl,\r\n  getExtensionManifest,\r\n  getIconPath,\r\n  resolveExtensionPath,\r\n  matchSize,\r\n  ResizeType,\r\n} from './common'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:browserAction')\r\n\r\nif (!app.isReady()) {\r\n  protocol.registerSchemesAsPrivileged([{ scheme: 'crx', privileges: { bypassCSP: true } }])\r\n}\r\n\r\ninterface ExtensionAction {\r\n  color?: string\r\n  text?: string\r\n  title?: string\r\n  icon?: chrome.browserAction.TabIconDetails\r\n  popup?: string\r\n  /** Last modified date for icon. */\r\n  iconModified?: number\r\n}\r\n\r\ntype ExtensionActionKey = keyof ExtensionAction\r\n\r\ninterface ActivateDetails {\r\n  eventType: string\r\n  extensionId: string\r\n  tabId: number\r\n  anchorRect: { x: number; y: number; width: number; height: number }\r\n}\r\n\r\nconst getBrowserActionDefaults = (extension: Electron.Extension): ExtensionAction | undefined => {\r\n  const manifest = getExtensionManifest(extension)\r\n  const { browser_action } = manifest\r\n  if (typeof browser_action === 'object') {\r\n    const action: ExtensionAction = {}\r\n\r\n    action.title = browser_action.default_title || manifest.name\r\n\r\n    const iconPath = getIconPath(extension)\r\n    if (iconPath) action.icon = { path: iconPath }\r\n\r\n    if (browser_action.default_popup) {\r\n      action.popup = browser_action.default_popup\r\n    }\r\n\r\n    return action\r\n  }\r\n}\r\n\r\ninterface ExtensionActionStore extends Partial<ExtensionAction> {\r\n  tabs: { [key: string]: ExtensionAction }\r\n}\r\n\r\nexport class BrowserActionAPI {\r\n  private actionMap = new Map</* extensionId */ string, ExtensionActionStore>()\r\n  private popup?: PopupView\r\n\r\n  private observers: Set<Electron.WebContents> = new Set()\r\n  private queuedUpdate: boolean = false\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n\r\n    const getter =\r\n      (propName: ExtensionActionKey) =>\r\n      ({ extension }: ExtensionEvent, details: chrome.browserAction.TabDetails = {}) => {\r\n        const { tabId } = details\r\n        const action = this.getAction(extension.id)\r\n\r\n        let result\r\n\r\n        if (tabId) {\r\n          if (action.tabs[tabId]) {\r\n            result = action.tabs[tabId][propName]\r\n          } else {\r\n            result = action[propName]\r\n          }\r\n        } else {\r\n          result = action[propName]\r\n        }\r\n\r\n        return result\r\n      }\r\n\r\n    const setDetails = (\r\n      { extension }: ExtensionEvent,\r\n      details: any,\r\n      propName: ExtensionActionKey\r\n    ) => {\r\n      const { tabId } = details\r\n      let value = (details as any)[propName] || undefined\r\n\r\n      if (typeof value === 'undefined') {\r\n        const defaults = getBrowserActionDefaults(extension)\r\n        value = defaults ? defaults[propName] : value\r\n      }\r\n\r\n      const valueObj = { [propName]: value }\r\n      const action = this.getAction(extension.id)\r\n\r\n      if (tabId) {\r\n        const tabAction = action.tabs[tabId] || (action.tabs[tabId] = {})\r\n        Object.assign(tabAction, valueObj)\r\n      } else {\r\n        Object.assign(action, valueObj)\r\n      }\r\n\r\n      this.onUpdate()\r\n    }\r\n\r\n    const setter =\r\n      (propName: ExtensionActionKey) =>\r\n      (event: ExtensionEvent, details: chrome.browserAction.TabDetails) =>\r\n        setDetails(event, details, propName)\r\n\r\n    const handleProp = (prop: string, key: ExtensionActionKey) => {\r\n      handle(`browserAction.get${prop}`, getter(key))\r\n      handle(`browserAction.set${prop}`, setter(key))\r\n    }\r\n\r\n    handleProp('BadgeBackgroundColor', 'color')\r\n    handleProp('BadgeText', 'text')\r\n    handleProp('Title', 'title')\r\n    handleProp('Popup', 'popup')\r\n\r\n    // setIcon is unique in that it can pass in a variety of properties. Here we normalize them\r\n    // to use 'icon'.\r\n    handle(\r\n      'browserAction.setIcon',\r\n      (event, { tabId, ...details }: chrome.browserAction.TabIconDetails) => {\r\n        setDetails(event, { tabId, icon: details }, 'icon')\r\n        setDetails(event, { tabId, iconModified: Date.now() }, 'iconModified')\r\n      }\r\n    )\r\n\r\n    // browserAction preload API\r\n    const preloadOpts = { allowRemote: true, extensionContext: false }\r\n    handle('browserAction.getState', this.getState.bind(this), preloadOpts)\r\n    handle('browserAction.activate', this.activate.bind(this), preloadOpts)\r\n    handle(\r\n      'browserAction.addObserver',\r\n      (event) => {\r\n        const { sender: webContents } = event\r\n        this.observers.add(webContents)\r\n        webContents.once('destroyed', () => {\r\n          this.observers.delete(webContents)\r\n        })\r\n      },\r\n      preloadOpts\r\n    )\r\n    handle(\r\n      'browserAction.removeObserver',\r\n      (event) => {\r\n        const { sender: webContents } = event\r\n        this.observers.delete(webContents)\r\n      },\r\n      preloadOpts\r\n    )\r\n\r\n    this.ctx.store.on('active-tab-changed', () => {\r\n      this.onUpdate()\r\n    })\r\n\r\n    // Clear out tab details when removed\r\n    this.ctx.store.on('tab-removed', (tabId: number) => {\r\n      for (const [, actionDetails] of this.actionMap) {\r\n        if (actionDetails.tabs[tabId]) {\r\n          delete actionDetails.tabs[tabId]\r\n        }\r\n      }\r\n      this.onUpdate()\r\n    })\r\n\r\n    this.setupSession(this.ctx.session)\r\n  }\r\n\r\n  private setupSession(session: Electron.Session) {\r\n    session.on('extension-loaded', (event, extension) => {\r\n      this.processExtension(extension)\r\n    })\r\n\r\n    session.on('extension-unloaded', (event, extension) => {\r\n      this.removeActions(extension.id)\r\n    })\r\n\r\n    session.protocol.registerBufferProtocol('crx', this.handleCrxRequest)\r\n  }\r\n\r\n  private handleCrxRequest = (\r\n    request: Electron.ProtocolRequest,\r\n    callback: (response: Electron.ProtocolResponse) => void\r\n  ) => {\r\n    debug('%s', request.url)\r\n\r\n    let response: Electron.ProtocolResponse\r\n\r\n    try {\r\n      const url = new URL(request.url)\r\n      const { hostname: requestType } = url\r\n\r\n      switch (requestType) {\r\n        case 'extension-icon': {\r\n          const tabId = url.searchParams.get('tabId')\r\n\r\n          const fragments = url.pathname.split('/')\r\n          const extensionId = fragments[1]\r\n          const imageSize = parseInt(fragments[2], 10)\r\n          const resizeType = parseInt(fragments[3], 10) || ResizeType.Up\r\n\r\n          const extension = this.ctx.session.getExtension(extensionId)\r\n\r\n          let iconDetails: chrome.browserAction.TabIconDetails | undefined\r\n\r\n          const action = this.actionMap.get(extensionId)\r\n          if (action) {\r\n            iconDetails = (tabId && action.tabs[tabId]?.icon) || action.icon\r\n          }\r\n\r\n          let iconImage\r\n\r\n          if (extension && iconDetails) {\r\n            if (typeof iconDetails.path === 'string') {\r\n              const iconAbsPath = resolveExtensionPath(extension, iconDetails.path)\r\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\r\n            } else if (typeof iconDetails.path === 'object') {\r\n              const imagePath = matchSize(iconDetails.path, imageSize, resizeType)\r\n              const iconAbsPath = imagePath && resolveExtensionPath(extension, imagePath)\r\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\r\n            } else if (typeof iconDetails.imageData === 'string') {\r\n              iconImage = nativeImage.createFromDataURL(iconDetails.imageData)\r\n            } else if (typeof iconDetails.imageData === 'object') {\r\n              const imageData = matchSize(iconDetails.imageData as any, imageSize, resizeType)\r\n              iconImage = imageData ? nativeImage.createFromDataURL(imageData) : undefined\r\n            }\r\n          }\r\n\r\n          if (iconImage) {\r\n            response = {\r\n              statusCode: 200,\r\n              mimeType: 'image/png',\r\n              data: iconImage.toPNG(),\r\n            }\r\n          } else {\r\n            response = { statusCode: 400 }\r\n          }\r\n\r\n          break\r\n        }\r\n        default: {\r\n          response = { statusCode: 400 }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(e)\r\n\r\n      response = {\r\n        statusCode: 500,\r\n      }\r\n    }\r\n\r\n    callback(response)\r\n  }\r\n\r\n  private getAction(extensionId: string) {\r\n    let action = this.actionMap.get(extensionId)\r\n    if (!action) {\r\n      action = { tabs: {} }\r\n      this.actionMap.set(extensionId, action)\r\n      this.onUpdate()\r\n    }\r\n\r\n    return action\r\n  }\r\n\r\n  // TODO: Make private for v4 major release.\r\n  removeActions(extensionId: string) {\r\n    if (this.actionMap.has(extensionId)) {\r\n      this.actionMap.delete(extensionId)\r\n    }\r\n\r\n    this.onUpdate()\r\n  }\r\n\r\n  private getPopupUrl(extensionId: string, tabId: number) {\r\n    const action = this.getAction(extensionId)\r\n    const popupPath = action.tabs[tabId]?.popup || action.popup || undefined\r\n    return popupPath && `chrome-extension://${extensionId}/${popupPath}`\r\n  }\r\n\r\n  // TODO: Make private for v4 major release.\r\n  processExtension(extension: Electron.Extension) {\r\n    const defaultAction = getBrowserActionDefaults(extension)\r\n    if (defaultAction) {\r\n      const action = this.getAction(extension.id)\r\n      Object.assign(action, defaultAction)\r\n    }\r\n  }\r\n\r\n  private getState() {\r\n    // Get state without icon data.\r\n    const actions = Array.from(this.actionMap.entries()).map(([id, details]) => {\r\n      const { icon, tabs, ...rest } = details\r\n\r\n      const tabsInfo: { [key: string]: any } = {}\r\n\r\n      for (const tabId of Object.keys(tabs)) {\r\n        const { icon, ...rest } = tabs[tabId]\r\n        tabsInfo[tabId] = rest\r\n      }\r\n\r\n      return {\r\n        id,\r\n        tabs: tabsInfo,\r\n        ...rest,\r\n      }\r\n    })\r\n\r\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\r\n    return { activeTabId: activeTab?.id, actions }\r\n  }\r\n\r\n  private activate(extEvt: ExtensionEvent, details: ActivateDetails) {\r\n    const { eventType, extensionId, tabId } = details\r\n\r\n    debug(\r\n      `activate [eventType: ${eventType}, extensionId: '${extensionId}', tabId: ${tabId}, senderId: ${extEvt.sender.id}]`\r\n    )\r\n\r\n    switch (eventType) {\r\n      case 'click':\r\n        this.activateClick(details)\r\n        break\r\n      case 'contextmenu':\r\n        this.activateContextMenu(details, extEvt)\r\n        break\r\n      default:\r\n        console.debug(`Ignoring unknown browserAction.activate event '${eventType}'`)\r\n    }\r\n  }\r\n\r\n  private activateClick(details: ActivateDetails) {\r\n    const { extensionId, tabId, anchorRect } = details\r\n\r\n    if (this.popup) {\r\n      const toggleExtension = !this.popup.isDestroyed() && this.popup.extensionId === extensionId\r\n      this.popup.destroy()\r\n      this.popup = undefined\r\n      if (toggleExtension) {\r\n        debug('skipping activate to close popup')\r\n        return\r\n      }\r\n    }\r\n\r\n    const tab =\r\n      tabId >= 0 ? this.ctx.store.getTabById(tabId) : this.ctx.store.getActiveTabOfCurrentWindow()\r\n    if (!tab) {\r\n      throw new Error(`Unable to get active tab`)\r\n    }\r\n\r\n    const popupUrl = this.getPopupUrl(extensionId, tab.id)\r\n\r\n    if (popupUrl) {\r\n      const win = this.ctx.store.tabToWindow.get(tab)\r\n      if (!win) {\r\n        throw new Error('Unable to get BrowserWindow from active tab')\r\n      }\r\n\r\n      this.popup = new PopupView({\r\n        extensionId,\r\n        session: this.ctx.session,\r\n        parent: win,\r\n        url: popupUrl,\r\n        anchorRect,\r\n      })\r\n\r\n      debug(`opened popup: ${popupUrl}`)\r\n\r\n      this.ctx.emit('browser-action-popup-created', this.popup)\r\n    } else {\r\n      debug(`dispatching onClicked for ${extensionId}`)\r\n\r\n      const tabDetails = this.ctx.store.tabDetailsCache.get(tab.id)\r\n      this.ctx.router.sendEvent(extensionId, 'browserAction.onClicked', tabDetails)\r\n    }\r\n  }\r\n\r\n  private activateContextMenu(details: ActivateDetails, event: ExtensionEvent) {\r\n    const { extensionId, anchorRect } = details\r\n\r\n    const extension = this.ctx.session.getExtension(extensionId)\r\n    if (!extension) {\r\n      throw new Error(`Unregistered extension '${extensionId}'`)\r\n    }\r\n\r\n    const manifest = getExtensionManifest(extension)\r\n    const menu = new Menu()\r\n    const append = (opts: Electron.MenuItemConstructorOptions) => menu.append(new MenuItem(opts))\r\n    const appendSeparator = () => menu.append(new MenuItem({ type: 'separator' }))\r\n\r\n    append({\r\n      label: extension.name,\r\n      click: () => {\r\n        const homePageUrl =\r\n          manifest.homepage_url || `https://chrome.google.com/webstore/detail/${extension.id}`\r\n        this.ctx.store.createTab({ url: homePageUrl }, event)\r\n      },\r\n    })\r\n\r\n    appendSeparator()\r\n\r\n    const contextMenuItems: MenuItem[] = this.ctx.store.buildMenuItems(\r\n      extensionId,\r\n      'browser_action'\r\n    )\r\n    if (contextMenuItems.length > 0) {\r\n      contextMenuItems.forEach((item) => menu.append(item))\r\n      appendSeparator()\r\n    }\r\n\r\n    const optionsPage = manifest.options_page || manifest.options_ui?.page\r\n    const optionsPageUrl = optionsPage ? getExtensionUrl(extension, optionsPage) : undefined\r\n\r\n    append({\r\n      label: 'Options',\r\n      enabled: typeof optionsPageUrl === 'string',\r\n      click: () => {\r\n        this.ctx.store.createTab({ url: optionsPageUrl }, event)\r\n      },\r\n    })\r\n\r\n    menu.popup({\r\n      x: Math.floor(anchorRect.x),\r\n      y: Math.floor(anchorRect.y + anchorRect.height),\r\n    })\r\n  }\r\n\r\n  private onUpdate() {\r\n    if (this.queuedUpdate) return\r\n    this.queuedUpdate = true\r\n    queueMicrotask(() => {\r\n      this.queuedUpdate = false\r\n      debug(`dispatching update to ${this.observers.size} observer(s)`)\r\n      Array.from(this.observers).forEach((observer) => {\r\n        if (!observer.isDestroyed()) {\r\n          observer.send('browserAction.update')\r\n        }\r\n      })\r\n    })\r\n  }\r\n}\r\n","import { ExtensionContext } from '../context'\r\n\r\n/**\r\n * Stub implementation for chrome.commands API.\r\n */\r\nexport class CommandsAPI {\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('commands.getAll', this.getAll)\r\n  }\r\n\r\n  getAll() {\r\n    return []\r\n  }\r\n}\r\n","import { promises as fs } from 'fs'\r\nimport * as path from 'path'\r\nimport { nativeImage } from 'electron'\r\n\r\nexport interface TabContents extends Electron.WebContents {\r\n  favicon?: string\r\n}\r\n\r\nexport type ContextMenuType =\r\n  | 'all'\r\n  | 'page'\r\n  | 'frame'\r\n  | 'selection'\r\n  | 'link'\r\n  | 'editable'\r\n  | 'image'\r\n  | 'video'\r\n  | 'audio'\r\n  | 'launcher'\r\n  | 'browser_action'\r\n  | 'page_action'\r\n  | 'action'\r\n\r\n/**\r\n * Get the extension's properly typed Manifest.\r\n *\r\n * I can't seem to get TS's merged type declarations working so I'm using this\r\n * instead for now.\r\n */\r\nexport const getExtensionManifest = (extension: Electron.Extension): chrome.runtime.Manifest =>\r\n  extension.manifest\r\n\r\nexport const getExtensionUrl = (extension: Electron.Extension, uri: string) => {\r\n  try {\r\n    return new URL(uri, extension.url).href\r\n  } catch {}\r\n}\r\n\r\nexport const resolveExtensionPath = (extension: Electron.Extension, uri: string) => {\r\n  const relpath = uri.indexOf(extension.url) === 0 ? uri.slice(extension.url.length) : uri;\r\n  const resPath = path.join(extension.path, relpath);\r\n\r\n  // prevent any parent traversals\r\n  if (!resPath.startsWith(extension.path)) return\r\n\r\n  return resPath\r\n}\r\n\r\nexport const validateExtensionResource = async (extension: Electron.Extension, uri: string) => {\r\n  const resPath = resolveExtensionPath(extension, uri)\r\n  if (!resPath) return\r\n\r\n  try {\r\n    await fs.stat(resPath)\r\n  } catch {\r\n    return // doesn't exist\r\n  }\r\n\r\n  return resPath\r\n}\r\n\r\nexport enum ResizeType {\r\n  Exact,\r\n  Up,\r\n  Down,\r\n}\r\n\r\nexport const matchSize = (\r\n  imageSet: { [key: number]: string },\r\n  size: number,\r\n  match: ResizeType\r\n): string | undefined => {\r\n  // TODO: match based on size\r\n  const first = parseInt(Object.keys(imageSet).pop()!, 10)\r\n  return imageSet[first]\r\n}\r\n\r\n/** Gets the relative path to the extension's default icon. */\r\nexport const getIconPath = (\r\n  extension: Electron.Extension,\r\n  iconSize: number = 32,\r\n  resizeType = ResizeType.Up\r\n) => {\r\n  const { browser_action, icons } = getExtensionManifest(extension)\r\n  const { default_icon } = browser_action || {}\r\n\r\n  if (typeof default_icon === 'string') {\r\n    const iconPath = default_icon\r\n    return iconPath\r\n  } else if (typeof default_icon === 'object') {\r\n    const iconPath = matchSize(default_icon, iconSize, resizeType)\r\n    return iconPath\r\n  } else if (typeof icons === 'object') {\r\n    const iconPath = matchSize(icons, iconSize, resizeType)\r\n    return iconPath\r\n  }\r\n}\r\n\r\nexport const getIconImage = (extension: Electron.Extension) => {\r\n  const iconPath = getIconPath(extension)\r\n  const iconAbsolutePath = iconPath && resolveExtensionPath(extension, iconPath)\r\n  return iconAbsolutePath ? nativeImage.createFromPath(iconAbsolutePath) : undefined\r\n}\r\n\r\nconst escapePattern = (pattern: string) => pattern.replace(/[\\\\^$+?.()|[\\]{}]/g, '\\\\$&')\r\n\r\n/**\r\n * @see https://developer.chrome.com/extensions/match_patterns\r\n */\r\nexport const matchesPattern = (pattern: string, url: string) => {\r\n  if (pattern === '<all_urls>') return true\r\n  const regexp = new RegExp(`^${pattern.split('*').map(escapePattern).join('.*')}$`)\r\n  return url.match(regexp)\r\n}\r\n","import { Menu, MenuItem } from 'electron'\r\nimport { MenuItemConstructorOptions } from 'electron/main'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { ContextMenuType, getIconImage, matchesPattern } from './common'\r\n\r\ntype ContextItemProps = chrome.contextMenus.CreateProperties & { id: string }\r\n\r\ntype ContextItemConstructorOptions = {\r\n  extension: Electron.Extension\r\n  props: ContextItemProps\r\n  webContents: Electron.WebContents\r\n  params?: Electron.ContextMenuParams\r\n  showIcon?: boolean\r\n}\r\n\r\nconst DEFAULT_CONTEXTS = ['page']\r\n\r\nconst getContextTypesFromParams = (params: Electron.ContextMenuParams): Set<ContextMenuType> => {\r\n  const contexts = new Set<ContextMenuType>(['all'])\r\n\r\n  switch (params.mediaType) {\r\n    case 'audio':\r\n    case 'video':\r\n    case 'image':\r\n      contexts.add(params.mediaType)\r\n  }\r\n\r\n  if (params.pageURL) contexts.add('page')\r\n  if (params.linkURL) contexts.add('link')\r\n  if (params.frameURL) contexts.add('frame')\r\n  if (params.selectionText) contexts.add('selection')\r\n  if (params.isEditable) contexts.add('editable')\r\n\r\n  return contexts\r\n}\r\n\r\nconst formatTitle = (title: string, params: Electron.ContextMenuParams) => {\r\n  if (params.selectionText && title.includes('%s')) {\r\n    title = title.split('%s').join(params.selectionText)\r\n  }\r\n  return title\r\n}\r\n\r\nconst matchesConditions = (\r\n  props: ContextItemProps,\r\n  conditions: {\r\n    contextTypes: Set<ContextMenuType>\r\n    targetUrl?: string\r\n    documentUrl?: string\r\n  }\r\n) => {\r\n  if (props.visible === false) return false\r\n\r\n  const { contextTypes, targetUrl, documentUrl } = conditions\r\n\r\n  const contexts = props.contexts || DEFAULT_CONTEXTS\r\n  const inContext = contexts.some((context) => contextTypes.has(context as ContextMenuType))\r\n  if (!inContext) return false\r\n\r\n  if (props.targetUrlPatterns && props.targetUrlPatterns.length > 0 && targetUrl) {\r\n    if (!props.targetUrlPatterns.some((pattern) => matchesPattern(pattern, targetUrl))) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  if (props.documentUrlPatterns && props.documentUrlPatterns.length > 0 && documentUrl) {\r\n    if (!props.documentUrlPatterns.some((pattern) => matchesPattern(pattern, documentUrl))) {\r\n      return false\r\n    }\r\n  }\r\n\r\n  return true\r\n}\r\n\r\nexport class ContextMenusAPI {\r\n  private menus = new Map<\r\n    /* extensionId */ string,\r\n    Map</* menuItemId */ string, ContextItemProps>\r\n  >()\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('contextMenus.create', this.create)\r\n    handle('contextMenus.remove', this.remove)\r\n    handle('contextMenus.removeAll', this.removeAll)\r\n\r\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\r\n      if (this.menus.has(extension.id)) {\r\n        this.menus.delete(extension.id)\r\n      }\r\n    })\r\n\r\n    this.ctx.store.buildMenuItems = this.buildMenuItemsForExtension.bind(this)\r\n  }\r\n\r\n  private addContextItem(extensionId: string, props: ContextItemProps) {\r\n    let contextItems = this.menus.get(extensionId)\r\n    if (!contextItems) {\r\n      contextItems = new Map()\r\n      this.menus.set(extensionId, contextItems)\r\n    }\r\n    contextItems.set(props.id, props)\r\n  }\r\n\r\n  private buildMenuItem = (opts: ContextItemConstructorOptions) => {\r\n    const { extension, props, webContents, params } = opts\r\n\r\n    // TODO: try to get the appropriately sized image before resizing\r\n    let icon = opts.showIcon ? getIconImage(extension) : undefined\r\n    if (icon) {\r\n      icon = icon.resize({ width: 16, height: 16 })\r\n    }\r\n\r\n    const menuItemOptions: MenuItemConstructorOptions = {\r\n      id: props.id,\r\n      type: props.type as any,\r\n      label: params ? formatTitle(props.title || '', params) : props.title || '',\r\n      icon,\r\n      enabled: props.enabled,\r\n      click: () => {\r\n        this.onClicked(extension.id, props.id, webContents, params)\r\n      },\r\n    }\r\n\r\n    return menuItemOptions\r\n  }\r\n\r\n  private buildMenuItemsFromTemplate = (menuItemTemplates: ContextItemConstructorOptions[]) => {\r\n    const itemMap = new Map<string, MenuItemConstructorOptions>()\r\n\r\n    // Group by ID\r\n    for (const item of menuItemTemplates) {\r\n      const menuItem = this.buildMenuItem(item)\r\n      itemMap.set(item.props.id, menuItem)\r\n    }\r\n\r\n    // Organize in tree\r\n    for (const item of menuItemTemplates) {\r\n      const menuItem = itemMap.get(item.props.id)\r\n      if (item.props.parentId) {\r\n        const parentMenuItem = itemMap.get(item.props.parentId)\r\n        if (parentMenuItem) {\r\n          const submenu = (parentMenuItem.submenu || []) as Electron.MenuItemConstructorOptions[]\r\n          submenu.push(menuItem!)\r\n          parentMenuItem.submenu = submenu\r\n        }\r\n      }\r\n    }\r\n\r\n    const menuItems: Electron.MenuItem[] = []\r\n\r\n    const buildFromTemplate = (opts: Electron.MenuItemConstructorOptions) => {\r\n      if (Array.isArray(opts.submenu)) {\r\n        const submenu = new Menu()\r\n        opts.submenu.forEach((item) => submenu.append(buildFromTemplate(item)))\r\n        opts.submenu = submenu\r\n      }\r\n      return new MenuItem(opts)\r\n    }\r\n\r\n    // Build all final MenuItems in-order\r\n    for (const item of menuItemTemplates) {\r\n      // Items with parents will be handled recursively\r\n      if (item.props.parentId) continue\r\n\r\n      const menuItem = itemMap.get(item.props.id)!\r\n      menuItems.push(buildFromTemplate(menuItem))\r\n    }\r\n\r\n    return menuItems\r\n  }\r\n\r\n  buildMenuItemsForParams(\r\n    webContents: Electron.WebContents,\r\n    params: Electron.ContextMenuParams\r\n  ): Electron.MenuItem[] {\r\n    if (webContents.session !== this.ctx.session) return []\r\n\r\n    const menuItemOptions = []\r\n\r\n    const conditions = {\r\n      contextTypes: getContextTypesFromParams(params),\r\n      targetUrl: params.srcURL || params.linkURL,\r\n      documentUrl: params.frameURL || params.pageURL,\r\n    }\r\n\r\n    for (const [extensionId, propItems] of this.menus) {\r\n      const extension = this.ctx.session.getExtension(extensionId)\r\n      if (!extension) continue\r\n\r\n      for (const [, props] of propItems) {\r\n        if (matchesConditions(props, conditions)) {\r\n          const menuItem = {\r\n            extension,\r\n            props,\r\n            webContents,\r\n            params,\r\n            showIcon: true,\r\n          }\r\n          menuItemOptions.push(menuItem)\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\r\n  }\r\n\r\n  private buildMenuItemsForExtension(\r\n    extensionId: string,\r\n    menuType: ContextMenuType\r\n  ): Electron.MenuItem[] {\r\n    const extensionItems = this.menus.get(extensionId)\r\n    const extension = this.ctx.session.getExtension(extensionId)\r\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\r\n\r\n    const menuItemOptions = []\r\n\r\n    if (extensionItems && extension && activeTab) {\r\n      const conditions = {\r\n        contextTypes: new Set<ContextMenuType>(['all', menuType]),\r\n      }\r\n\r\n      for (const [, props] of extensionItems) {\r\n        if (matchesConditions(props, conditions)) {\r\n          const menuItem = { extension, props, webContents: activeTab }\r\n          menuItemOptions.push(menuItem)\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\r\n  }\r\n\r\n  private create = ({ extension }: ExtensionEvent, createProperties: ContextItemProps) => {\r\n    const { id, type, title } = createProperties\r\n\r\n    if (this.menus.has(id)) {\r\n      // TODO: duplicate error\r\n      return\r\n    }\r\n\r\n    if (!title && type !== 'separator') {\r\n      // TODO: error\r\n      return\r\n    }\r\n\r\n    this.addContextItem(extension.id, createProperties)\r\n  }\r\n\r\n  private remove = ({ extension }: ExtensionEvent, menuItemId: string) => {\r\n    const items = this.menus.get(extension.id)\r\n    if (items && items.has(menuItemId)) {\r\n      items.delete(menuItemId)\r\n      if (items.size === 0) {\r\n        this.menus.delete(extension.id)\r\n      }\r\n    }\r\n  }\r\n\r\n  private removeAll = ({ extension }: ExtensionEvent) => {\r\n    this.menus.delete(extension.id)\r\n  }\r\n\r\n  private onClicked(\r\n    extensionId: string,\r\n    menuItemId: string,\r\n    webContents: Electron.WebContents,\r\n    params?: Electron.ContextMenuParams\r\n  ) {\r\n    if (webContents.isDestroyed()) return\r\n\r\n    const tab = this.ctx.store.tabDetailsCache.get(webContents.id)\r\n    if (!tab) {\r\n      console.error(`[Extensions] Unable to find tab for id=${webContents.id}`)\r\n      return\r\n    }\r\n\r\n    const data: chrome.contextMenus.OnClickData = {\r\n      selectionText: params?.selectionText,\r\n      checked: false, // TODO\r\n      menuItemId,\r\n      frameId: -1, // TODO: match frameURL with webFrameMain in Electron 12\r\n      frameUrl: params?.frameURL,\r\n      editable: params?.isEditable || false,\r\n      mediaType: params?.mediaType,\r\n      wasChecked: false, // TODO\r\n      pageUrl: params?.pageURL as any, // types are inaccurate\r\n      linkUrl: params?.linkURL,\r\n      parentMenuItemId: -1, // TODO\r\n      srcUrl: params?.srcURL,\r\n    }\r\n\r\n    this.ctx.router.sendEvent(extensionId, 'contextMenus.onClicked', data, tab)\r\n  }\r\n}\r\n","import { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\n\r\nenum CookieStoreID {\r\n  Default = '0',\r\n  Incognito = '1',\r\n}\r\n\r\nconst onChangedCauseTranslation: { [key: string]: string } = {\r\n  'expired-overwrite': 'expired_overwrite',\r\n}\r\n\r\nconst createCookieDetails = (cookie: Electron.Cookie): chrome.cookies.Cookie => ({\r\n  ...cookie,\r\n  domain: cookie.domain || '',\r\n  hostOnly: Boolean(cookie.hostOnly),\r\n  session: Boolean(cookie.session),\r\n  path: cookie.path || '',\r\n  httpOnly: Boolean(cookie.httpOnly),\r\n  secure: Boolean(cookie.secure),\r\n  storeId: CookieStoreID.Default,\r\n})\r\n\r\nexport class CookiesAPI {\r\n  private get cookies() {\r\n    return this.ctx.session.cookies\r\n  }\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('cookies.get', this.get.bind(this))\r\n    handle('cookies.getAll', this.getAll.bind(this))\r\n    handle('cookies.set', this.set.bind(this))\r\n    handle('cookies.remove', this.remove.bind(this))\r\n    handle('cookies.getAllCookieStores', this.getAllCookieStores.bind(this))\r\n\r\n    this.cookies.addListener('changed', this.onChanged)\r\n  }\r\n\r\n  private async get(\r\n    event: ExtensionEvent,\r\n    details: chrome.cookies.Details\r\n  ): Promise<chrome.cookies.Cookie | null> {\r\n    // TODO: storeId\r\n    const cookies = await this.cookies.get({\r\n      url: details.url,\r\n      name: details.name,\r\n    })\r\n\r\n    // TODO: If more than one cookie of the same name exists for the given URL,\r\n    // the one with the longest path will be returned. For cookies with the\r\n    // same path length, the cookie with the earliest creation time will be returned.\r\n    return cookies.length > 0 ? createCookieDetails(cookies[0]) : null\r\n  }\r\n\r\n  private async getAll(\r\n    event: ExtensionEvent,\r\n    details: chrome.cookies.GetAllDetails\r\n  ): Promise<chrome.cookies.Cookie[]> {\r\n    // TODO: storeId\r\n    const cookies = await this.cookies.get({\r\n      url: details.url,\r\n      name: details.name,\r\n      domain: details.domain,\r\n      path: details.path,\r\n      secure: details.secure,\r\n      session: details.session,\r\n    })\r\n\r\n    return cookies.map(createCookieDetails)\r\n  }\r\n\r\n  private async set(\r\n    event: ExtensionEvent,\r\n    details: chrome.cookies.SetDetails\r\n  ): Promise<chrome.cookies.Cookie | null> {\r\n    await this.cookies.set(details)\r\n    const cookies = await this.cookies.get(details)\r\n    return cookies.length > 0 ? createCookieDetails(cookies[0]) : null\r\n  }\r\n\r\n  private async remove(\r\n    event: ExtensionEvent,\r\n    details: chrome.cookies.Details\r\n  ): Promise<chrome.cookies.Details | null> {\r\n    try {\r\n      await this.cookies.remove(details.url, details.name)\r\n    } catch {\r\n      return null\r\n    }\r\n    return details\r\n  }\r\n\r\n  private async getAllCookieStores(event: ExtensionEvent): Promise<chrome.cookies.CookieStore[]> {\r\n    const tabIds = Array.from(this.ctx.store.tabs)\r\n      .map((tab) => (tab.isDestroyed() ? undefined : tab.id))\r\n      .filter(Boolean) as number[]\r\n    return [{ id: CookieStoreID.Default, tabIds }]\r\n  }\r\n\r\n  private onChanged = (event: Event, cookie: Electron.Cookie, cause: string, removed: boolean) => {\r\n    const changeInfo: chrome.cookies.CookieChangeInfo = {\r\n      cause: onChangedCauseTranslation[cause] || cause,\r\n      cookie: createCookieDetails(cookie),\r\n      removed,\r\n    }\r\n\r\n    this.ctx.router.broadcastEvent('cookies.onChanged', changeInfo)\r\n  }\r\n}\r\n","import { app, Extension, Notification } from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { validateExtensionResource } from './common'\r\n\r\nenum TemplateType {\r\n  Basic = 'basic',\r\n  Image = 'image',\r\n  List = 'list',\r\n  Progress = 'progress',\r\n}\r\n\r\nconst getBody = (opts: chrome.notifications.NotificationOptions) => {\r\n  const { type = TemplateType.Basic } = opts\r\n\r\n  switch (type) {\r\n    case TemplateType.List: {\r\n      if (!Array.isArray(opts.items)) {\r\n        throw new Error('List items must be provided for list type')\r\n      }\r\n      return opts.items.map((item) => `${item.title} - ${item.message}`).join('\\n')\r\n    }\r\n    default:\r\n      return opts.message || ''\r\n  }\r\n}\r\n\r\nconst getUrgency = (\r\n  priority?: number\r\n): Required<Electron.NotificationConstructorOptions>['urgency'] => {\r\n  if (typeof priority !== 'number') {\r\n    return 'normal'\r\n  } else if (priority >= 2) {\r\n    return 'critical'\r\n  } else if (priority < 0) {\r\n    return 'low'\r\n  } else {\r\n    return 'normal'\r\n  }\r\n}\r\n\r\nconst createScopedIdentifier = (extension: Extension, id: string) => `${extension.id}-${id}`\r\nconst stripScopeFromIdentifier = (id: string) => {\r\n  const index = id.indexOf('-')\r\n  return id.substr(index + 1)\r\n}\r\n\r\nexport class NotificationsAPI {\r\n  private registry = new Map<string, Notification>()\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('notifications.clear', this.clear)\r\n    handle('notifications.create', this.create)\r\n    handle('notifications.getAll', this.getAll)\r\n    handle('notifications.getPermissionLevel', this.getPermissionLevel)\r\n    handle('notifications.update', this.update)\r\n\r\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\r\n      for (const [key, notification] of this.registry) {\r\n        if (key.startsWith(extension.id)) {\r\n          notification.close()\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  private clear = ({ extension }: ExtensionEvent, id: string) => {\r\n    const notificationId = createScopedIdentifier(extension, id)\r\n    if (this.registry.has(notificationId)) {\r\n      this.registry.get(notificationId)?.close()\r\n    }\r\n  }\r\n\r\n  private create = async ({ extension }: ExtensionEvent, arg1: unknown, arg2?: unknown) => {\r\n    let id: string\r\n    let opts: chrome.notifications.NotificationOptions\r\n\r\n    if (typeof arg1 === 'object') {\r\n      id = 'guid' // TODO: generate uuid\r\n      opts = arg1 as chrome.notifications.NotificationOptions\r\n    } else if (typeof arg1 === 'string') {\r\n      id = arg1\r\n      opts = arg2 as chrome.notifications.NotificationOptions\r\n    } else {\r\n      throw new Error('Invalid arguments')\r\n    }\r\n\r\n    if (typeof opts !== 'object' || !opts.type || !opts.iconUrl || !opts.title || !opts.message) {\r\n      throw new Error('Missing required notification options')\r\n    }\r\n\r\n    const notificationId = createScopedIdentifier(extension, id)\r\n\r\n    if (this.registry.has(notificationId)) {\r\n      this.registry.get(notificationId)?.close()\r\n    }\r\n\r\n    let icon\r\n\r\n    if (opts.iconUrl) {\r\n      let url\r\n      try {\r\n        url = new URL(opts.iconUrl)\r\n      } catch {}\r\n\r\n      if (url?.protocol === 'data:') {\r\n        icon = opts.iconUrl\r\n      } else {\r\n        icon = await validateExtensionResource(extension, opts.iconUrl)\r\n      }\r\n\r\n      if (!icon) {\r\n        throw new Error('Invalid iconUrl')\r\n      }\r\n    }\r\n\r\n    // TODO: buttons, template types\r\n\r\n    const notification = new Notification({\r\n      title: opts.title,\r\n      subtitle: app.name,\r\n      body: getBody(opts),\r\n      silent: opts.silent,\r\n      icon,\r\n      urgency: getUrgency(opts.priority),\r\n      timeoutType: opts.requireInteraction ? 'never' : 'default',\r\n    })\r\n\r\n    this.registry.set(notificationId, notification)\r\n\r\n    notification.on('click', () => {\r\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClicked', id)\r\n    })\r\n\r\n    notification.once('close', () => {\r\n      const byUser = true // TODO\r\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClosed', id, byUser)\r\n      this.registry.delete(notificationId)\r\n    })\r\n\r\n    notification.show()\r\n\r\n    return id\r\n  }\r\n\r\n  private getAll = ({ extension }: ExtensionEvent) => {\r\n    return Array.from(this.registry.keys())\r\n      .filter((key) => key.startsWith(extension.id))\r\n      .map(stripScopeFromIdentifier)\r\n  }\r\n\r\n  private getPermissionLevel = (event: ExtensionEvent) => {\r\n    return Notification.isSupported() ? 'granted' : 'denied'\r\n  }\r\n\r\n  private update = (\r\n    { extension }: ExtensionEvent,\r\n    id: string,\r\n    opts: chrome.notifications.NotificationOptions\r\n  ) => {\r\n    const notificationId = createScopedIdentifier(extension, id)\r\n\r\n    const notification = this.registry.get(notificationId)\r\n\r\n    if (!notification) {\r\n      return false\r\n    }\r\n\r\n    // TODO: remaining opts\r\n\r\n    if (opts.priority) notification.urgency = getUrgency(opts.priority)\r\n    if (opts.silent) notification.silent = opts.silent\r\n  }\r\n}\r\n","import { EventEmitter } from 'events'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { getExtensionManifest } from './common'\r\n\r\nexport class RuntimeAPI extends EventEmitter {\r\n  constructor(private ctx: ExtensionContext) {\r\n    super()\r\n\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('runtime.openOptionsPage', this.openOptionsPage)\r\n  }\r\n\r\n  private openOptionsPage = async (event: ExtensionEvent) => {\r\n    // TODO: options page shouldn't appear in Tabs API\r\n    // https://developer.chrome.com/extensions/options#tabs-api\r\n\r\n    const extension = event.extension;\r\n    const manifest = getExtensionManifest(extension)\r\n\r\n    if (manifest.options_ui) {\r\n      // Embedded option not support (!options_ui.open_in_new_tab)\r\n      const url = `chrome-extension://${extension.id}/${manifest.options_ui.page}`\r\n      await this.ctx.store.createTab({ url, active: true }, event)\r\n    } else if (manifest.options_page) {\r\n      const url = `chrome-extension://${extension.id}/${manifest.options_page}`\r\n      await this.ctx.store.createTab({ url, active: true }, event)\r\n    }\r\n  }\r\n}\r\n","import path from 'node:path'\r\nimport { parse } from 'node:url'\r\nimport { BrowserWindow } from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { ensureSuffix } from '../utils'\r\nimport { TabContents } from './common'\r\nimport { WindowsAPI } from './windows'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:tabs')\r\n\r\nexport class TabsAPI {\r\n  static TAB_ID_NONE = -1\r\n  static WINDOW_ID_NONE = -1\r\n  static WINDOW_ID_CURRENT = -2\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('tabs.get', this.get.bind(this))\r\n    handle('tabs.getAllInWindow', this.getAllInWindow.bind(this))\r\n    handle('tabs.getCurrent', this.getCurrent.bind(this))\r\n    handle('tabs.create', this.create.bind(this))\r\n    handle('tabs.insertCSS', this.insertCSS.bind(this))\r\n    handle('tabs.query', this.query.bind(this))\r\n    handle('tabs.reload', this.reload.bind(this))\r\n    handle('tabs.update', this.update.bind(this))\r\n    handle('tabs.remove', this.remove.bind(this))\r\n    handle('tabs.goForward', this.goForward.bind(this))\r\n    handle('tabs.goBack', this.goBack.bind(this))\r\n\r\n    this.ctx.store.on('tab-added', this.observeTab.bind(this))\r\n  }\r\n\r\n  private observeTab(tab: TabContents) {\r\n    const tabId = tab.id\r\n\r\n    const updateEvents = [\r\n      'page-title-updated', // title\r\n      'did-start-loading', // status\r\n      'did-stop-loading', // status\r\n      'media-started-playing', // audible\r\n      'media-paused', // audible\r\n      'did-start-navigation', // url\r\n      'did-redirect-navigation', // url\r\n      'did-navigate-in-page', // url\r\n    ]\r\n\r\n    const updateHandler = () => {\r\n      this.onUpdated(tabId)\r\n    }\r\n\r\n    updateEvents.forEach((eventName) => {\r\n      tab.on(eventName as any, updateHandler)\r\n    })\r\n\r\n    const faviconHandler = (event: Electron.Event, favicons: string[]) => {\r\n      ;(tab as TabContents).favicon = favicons[0]\r\n      this.onUpdated(tabId)\r\n    }\r\n    tab.on('page-favicon-updated', faviconHandler)\r\n\r\n    tab.once('destroyed', () => {\r\n      updateEvents.forEach((eventName) => {\r\n        tab.off(eventName as any, updateHandler)\r\n      })\r\n      tab.off('page-favicon-updated', faviconHandler)\r\n\r\n      this.ctx.store.removeTab(tab)\r\n      this.onRemoved(tabId)\r\n    })\r\n\r\n    this.onCreated(tabId)\r\n    this.onActivated(tabId)\r\n\r\n    debug(`Observing tab[${tabId}][${tab.getType()}] ${tab.getURL()}`)\r\n  }\r\n\r\n  private createTabDetails(tab: TabContents) {\r\n    const tabId = tab.id\r\n    const activeTab = this.ctx.store.getActiveTabFromWebContents(tab)\r\n    let win = this.ctx.store.tabToWindow.get(tab)\r\n    if (win?.isDestroyed()) win = undefined\r\n    const [width = 0, height = 0] = win ? win.getSize() : []\r\n\r\n    const details: chrome.tabs.Tab = {\r\n      active: activeTab?.id === tabId,\r\n      audible: tab.isCurrentlyAudible(),\r\n      autoDiscardable: true,\r\n      discarded: false,\r\n      favIconUrl: tab.favicon || undefined,\r\n      height,\r\n      highlighted: false,\r\n      id: tabId,\r\n      incognito: false,\r\n      index: -1, // TODO\r\n      mutedInfo: { muted: tab.audioMuted },\r\n      pinned: false,\r\n      selected: true,\r\n      status: tab.isLoading() ? 'loading' : 'complete',\r\n      title: tab.getTitle(),\r\n      url: tab.getURL(), // TODO: tab.mainFrame.url (Electron 12)\r\n      width,\r\n      windowId: win ? win.id : -1,\r\n    }\r\n\r\n    if (typeof this.ctx.store.impl.assignTabDetails === 'function') {\r\n      this.ctx.store.impl.assignTabDetails(details, tab)\r\n    }\r\n\r\n    this.ctx.store.tabDetailsCache.set(tab.id, details)\r\n    return details\r\n  }\r\n\r\n  private getTabDetails(tab: TabContents) {\r\n    if (this.ctx.store.tabDetailsCache.has(tab.id)) {\r\n      return this.ctx.store.tabDetailsCache.get(tab.id)\r\n    }\r\n    const details = this.createTabDetails(tab)\r\n    return details\r\n  }\r\n\r\n  private get(event: ExtensionEvent, tabId: number) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return { id: TabsAPI.TAB_ID_NONE }\r\n    return this.getTabDetails(tab)\r\n  }\r\n\r\n  private getAllInWindow(event: ExtensionEvent, windowId: number = TabsAPI.WINDOW_ID_CURRENT) {\r\n    if (windowId === TabsAPI.WINDOW_ID_CURRENT) windowId = this.ctx.store.lastFocusedWindowId!\r\n\r\n    const tabs = Array.from(this.ctx.store.tabs).filter((tab) => {\r\n      if (tab.isDestroyed()) return false\r\n\r\n      const browserWindow = this.ctx.store.tabToWindow.get(tab)\r\n      if (!browserWindow || browserWindow.isDestroyed()) return\r\n\r\n      return browserWindow.id === windowId\r\n    })\r\n\r\n    return tabs.map(this.getTabDetails.bind(this))\r\n  }\r\n\r\n  private getCurrent(event: ExtensionEvent) {\r\n    const tab = this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n    return tab ? this.getTabDetails(tab) : undefined\r\n  }\r\n\r\n  private async create(event: ExtensionEvent, details: chrome.tabs.CreateProperties = {}) {\r\n    let url = details.url;\r\n\r\n    // TODO: add test for this process\r\n    if (url && event.extension) {\r\n      const urlInfo = parse(url || '');\r\n      const baseURL = ensureSuffix(event.extension.url, '/');\r\n\r\n      if (!urlInfo.protocol && !urlInfo.hostname) {\r\n        url = path.posix.join(baseURL, url);\r\n      } else if (!urlInfo.hostname) {\r\n        url = path.posix.join(baseURL, url);\r\n      }\r\n    }\r\n\r\n    const tab = await this.ctx.store.createTab({...details, url}, event)\r\n    if (!tab) return ;\r\n\r\n    const tabDetails = this.getTabDetails(tab)\r\n    if (details.active) {\r\n      queueMicrotask(() => this.onActivated(tab.id))\r\n    }\r\n    return tabDetails\r\n  }\r\n\r\n  private insertCSS(event: ExtensionEvent, tabId: number, details: chrome.tabs.InjectDetails) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return\r\n\r\n    // TODO: move to webFrame in renderer?\r\n    if (details.code) {\r\n      tab.insertCSS(details.code)\r\n    }\r\n  }\r\n\r\n  private async query(event: ExtensionEvent, info: chrome.tabs.QueryInfo = {}) {\r\n    const isSet = (value: any) => typeof value !== 'undefined'\r\n\r\n    const lastFocusedWindow = this.ctx.store.getLastFocusedWindow() || null;\r\n    const currentWin = await this.ctx.store.windowsGetCurrent(event);\r\n\r\n    const filteredTabs = Array.from(this.ctx.store.tabs)\r\n      .map(this.getTabDetails.bind(this))\r\n      .filter((tab) => {\r\n        if (!tab) return false\r\n        if (isSet(info.active) && info.active !== tab.active) return false\r\n        if (isSet(info.pinned) && info.pinned !== tab.pinned) return false\r\n        if (isSet(info.audible) && info.audible !== tab.audible) return false\r\n        if (isSet(info.muted) && info.muted !== tab.mutedInfo?.muted) return false\r\n        if (isSet(info.highlighted) && info.highlighted !== tab.highlighted) return false\r\n        if (isSet(info.discarded) && info.discarded !== tab.discarded) return false\r\n        if (isSet(info.autoDiscardable) && info.autoDiscardable !== tab.autoDiscardable)\r\n          return false\r\n\r\n        if (isSet(info.currentWindow)) {\r\n          if (info.currentWindow && !currentWin) return false;\r\n          if (info.currentWindow && currentWin?.id !== tab.windowId) return false;\r\n        }\r\n\r\n        if (isSet(info.lastFocusedWindow)) {\r\n          if (info.lastFocusedWindow && !lastFocusedWindow) return false;\r\n          if (info.lastFocusedWindow && lastFocusedWindow?.id !== tab.windowId) return false;\r\n        }\r\n        \r\n        if (isSet(info.status) && info.status !== tab.status) return false\r\n        if (isSet(info.title) && info.title !== tab.title) return false // TODO: pattern match\r\n        if (isSet(info.url) && info.url !== tab.url) return false // TODO: match URL pattern\r\n        if (isSet(info.windowId)) {\r\n          if (info.windowId === TabsAPI.WINDOW_ID_CURRENT) {\r\n            if (!currentWin || (currentWin?.id !== tab.windowId)) return false\r\n          } else if (info.windowId !== tab.windowId) {\r\n            return false\r\n          }\r\n        }\r\n        // if (isSet(info.windowType) && info.windowType !== tab.windowType) return false\r\n        // if (isSet(info.index) && info.index !== tab.index) return false\r\n        return true\r\n      })\r\n      .map((tab, index) => {\r\n        if (tab) {\r\n          tab.index = index\r\n        }\r\n        return tab\r\n      })\r\n    return filteredTabs\r\n  }\r\n\r\n  private reload(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\r\n    const tabId: number | undefined = typeof arg1 === 'number' ? arg1 : undefined\r\n    const reloadProperties: chrome.tabs.ReloadProperties | null =\r\n      typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : {}\r\n\r\n    const tab = tabId\r\n      ? this.ctx.store.getTabById(tabId)\r\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n\r\n    if (!tab) return\r\n\r\n    if (reloadProperties?.bypassCache) {\r\n      tab.reloadIgnoringCache()\r\n    } else {\r\n      tab.reload()\r\n    }\r\n  }\r\n\r\n  private async update(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\r\n    let tabId = typeof arg1 === 'number' ? arg1 : undefined\r\n    const updateProperties: chrome.tabs.UpdateProperties =\r\n      (typeof arg1 === 'object' ? (arg1 as any) : (arg2 as any)) || {}\r\n\r\n    const tab = tabId\r\n      ? this.ctx.store.getTabById(tabId)\r\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n    if (!tab) return\r\n\r\n    tabId = tab.id\r\n\r\n    const props = updateProperties\r\n\r\n    // TODO: validate URL, prevent 'javascript:'\r\n    if (props.url) await tab.loadURL(props.url)\r\n\r\n    if (typeof props.muted === 'boolean') tab.setAudioMuted(props.muted)\r\n\r\n    if (props.active) this.onActivated(tabId)\r\n\r\n    this.onUpdated(tabId)\r\n\r\n    return this.createTabDetails(tab)\r\n  }\r\n\r\n  private remove(event: ExtensionEvent, id: number | number[]) {\r\n    const ids = Array.isArray(id) ? id : [id]\r\n\r\n    ids.forEach((tabId) => {\r\n      const tab = this.ctx.store.getTabById(tabId)\r\n      if (tab) this.ctx.store.removeTab(tab)\r\n      this.onRemoved(tabId)\r\n    })\r\n  }\r\n\r\n  private goForward(event: ExtensionEvent, arg1?: unknown) {\r\n    const tabId = typeof arg1 === 'number' ? arg1 : undefined\r\n    const tab = tabId\r\n      ? this.ctx.store.getTabById(tabId)\r\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n    if (!tab) return\r\n    tab.goForward()\r\n  }\r\n\r\n  private goBack(event: ExtensionEvent, arg1?: unknown) {\r\n    const tabId = typeof arg1 === 'number' ? arg1 : undefined\r\n    const tab = tabId\r\n      ? this.ctx.store.getTabById(tabId)\r\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\r\n    if (!tab) return\r\n    tab.goBack()\r\n  }\r\n\r\n  onCreated(tabId: number) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return\r\n    const tabDetails = this.getTabDetails(tab)\r\n    this.ctx.router.broadcastEvent('tabs.onCreated', tabDetails)\r\n  }\r\n\r\n  onUpdated(tabId: number) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return\r\n\r\n    let prevDetails\r\n    if (this.ctx.store.tabDetailsCache.has(tab.id)) {\r\n      prevDetails = this.ctx.store.tabDetailsCache.get(tab.id)\r\n    }\r\n    if (!prevDetails) return\r\n\r\n    const details = this.createTabDetails(tab)\r\n\r\n    const compareProps: (keyof chrome.tabs.Tab)[] = [\r\n      'status',\r\n      'url',\r\n      'pinned',\r\n      'audible',\r\n      'discarded',\r\n      'autoDiscardable',\r\n      'mutedInfo',\r\n      'favIconUrl',\r\n      'title',\r\n    ]\r\n\r\n    let didUpdate = false\r\n    const changeInfo: chrome.tabs.TabChangeInfo = {}\r\n\r\n    for (const prop of compareProps) {\r\n      if (details[prop] !== prevDetails[prop]) {\r\n        ;(changeInfo as any)[prop] = details[prop]\r\n        didUpdate = true\r\n      }\r\n    }\r\n\r\n    if (!didUpdate) return\r\n\r\n    this.ctx.router.broadcastEvent('tabs.onUpdated', tab.id, changeInfo, details)\r\n  }\r\n\r\n  onRemoved(tabId: number) {\r\n    const details = this.ctx.store.tabDetailsCache.has(tabId)\r\n      ? this.ctx.store.tabDetailsCache.get(tabId)\r\n      : null\r\n    this.ctx.store.tabDetailsCache.delete(tabId)\r\n\r\n    const windowId = details ? details.windowId : WindowsAPI.WINDOW_ID_NONE\r\n    const win =\r\n      typeof windowId !== 'undefined' && windowId > -1\r\n        ? BrowserWindow.getAllWindows().find((win) => win.id === windowId)\r\n        : null\r\n\r\n    this.ctx.router.broadcastEvent('tabs.onRemoved', tabId, {\r\n      windowId,\r\n      isWindowClosing: win ? win.isDestroyed() : false,\r\n    })\r\n  }\r\n\r\n  onActivated(tabId: number) {\r\n    const tab = this.ctx.store.getTabById(tabId)\r\n    if (!tab) return\r\n\r\n    const activeTab = this.ctx.store.getActiveTabFromWebContents(tab)\r\n    const activeChanged = activeTab?.id !== tabId\r\n    if (!activeChanged) return\r\n\r\n    const win = this.ctx.store.tabToWindow.get(tab)\r\n\r\n    this.ctx.store.setActiveTab(tab)\r\n\r\n    // invalidate cache since 'active' has changed\r\n    this.ctx.store.tabDetailsCache.forEach((tabInfo, cacheTabId) => {\r\n      tabInfo.active = tabId === cacheTabId\r\n    })\r\n\r\n    this.ctx.router.broadcastEvent('tabs.onActivated', {\r\n      tabId,\r\n      windowId: win?.id,\r\n    })\r\n  }\r\n}\r\n","import * as electron from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:webNavigation')\r\n\r\n// https://github.com/electron/electron/pull/25464\r\nconst getFrame = (frameProcessId: number, frameRoutingId: number) => {\r\n  return (\r\n    ('webFrameMain' in electron &&\r\n      (electron as any).webFrameMain.fromId(frameProcessId, frameRoutingId)) ||\r\n    null\r\n  )\r\n}\r\n\r\nconst getFrameId = (frame: any) =>\r\n  'webFrameMain' in electron ? (frame === frame.top ? 0 : frame.frameTreeNodeId) : -1\r\n\r\nconst getParentFrameId = (frame: any) => {\r\n  const parentFrame = frame?.parent\r\n  return parentFrame ? getFrameId(parentFrame) : -1\r\n}\r\n\r\nconst getFrameDetails = (frame: any) => ({\r\n  errorOccurred: false, // TODO\r\n  processId: frame.processId,\r\n  frameId: getFrameId(frame),\r\n  parentFrameId: getParentFrameId(frame),\r\n  url: frame.url,\r\n})\r\n\r\nexport class WebNavigationAPI {\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('webNavigation.getFrame', this.getFrame.bind(this))\r\n    handle('webNavigation.getAllFrames', this.getAllFrames.bind(this))\r\n\r\n    this.ctx.store.on('tab-added', this.observeTab.bind(this))\r\n  }\r\n\r\n  private observeTab(tab: Electron.WebContents) {\r\n    tab.once('will-navigate', this.onCreatedNavigationTarget as any)\r\n    tab.on('did-start-navigation', this.onBeforeNavigate as any)\r\n    tab.on('did-frame-finish-load', this.onFinishLoad as any)\r\n    tab.on('did-frame-navigate', this.onCommitted as any)\r\n    tab.on('did-navigate-in-page', this.onHistoryStateUpdated as any)\r\n\r\n    tab.on('frame-created', (e, { frame }) => {\r\n      if (frame.top === frame) return\r\n\r\n      frame.on('dom-ready', () => {\r\n        this.onDOMContentLoaded(tab, frame)\r\n      })\r\n    })\r\n\r\n    // Main frame dom-ready event\r\n    tab.on('dom-ready', () => {\r\n      if ('mainFrame' in tab) {\r\n        this.onDOMContentLoaded(tab, tab.mainFrame)\r\n      }\r\n    })\r\n  }\r\n\r\n  private getFrame(\r\n    event: ExtensionEvent,\r\n    details: chrome.webNavigation.GetFrameDetails\r\n  ): chrome.webNavigation.GetFrameResultDetails | null {\r\n    const tab = this.ctx.store.getTabById(details.tabId)\r\n    if (!tab) return null\r\n\r\n    let targetFrame: any\r\n\r\n    if (typeof details.frameId === 'number') {\r\n      // https://github.com/electron/electron/pull/25464\r\n      if ('mainFrame' in tab) {\r\n        const mainFrame = (tab as any).mainFrame\r\n        targetFrame = mainFrame.framesInSubtree.find((frame: any) => {\r\n          const isMainFrame = frame === frame.top\r\n          return isMainFrame ? details.frameId === 0 : details.frameId === frame.frameTreeNodeId\r\n        })\r\n      }\r\n    }\r\n\r\n    return targetFrame ? getFrameDetails(targetFrame) : null\r\n  }\r\n\r\n  private getAllFrames(\r\n    event: ExtensionEvent,\r\n    details: chrome.webNavigation.GetFrameDetails\r\n  ): chrome.webNavigation.GetAllFrameResultDetails[] | null {\r\n    const tab = this.ctx.store.getTabById(details.tabId)\r\n    if (!tab || !('mainFrame' in tab)) return []\r\n    return (tab as any).mainFrame.framesInSubtree.map(getFrameDetails)\r\n  }\r\n\r\n  private sendNavigationEvent = (eventName: string, details: { url: string }) => {\r\n    debug(`${eventName} [url: ${details.url}]`)\r\n    this.ctx.router.broadcastEvent(`webNavigation.${eventName}`, details)\r\n  }\r\n\r\n  private onCreatedNavigationTarget = (\r\n    event: Electron.IpcMainEvent,\r\n    url: string,\r\n    isInPlace: boolean,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const details: chrome.webNavigation.WebNavigationSourceCallbackDetails = {\r\n      sourceTabId: tab.id,\r\n      sourceProcessId: frameProcessId,\r\n      sourceFrameId: getFrameId(frame),\r\n      url,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n    }\r\n    this.sendNavigationEvent('onCreatedNavigationTarget', details)\r\n  }\r\n\r\n  private onBeforeNavigate = (\r\n    event: Electron.IpcMainEvent,\r\n    url: string,\r\n    isInPlace: number,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    if (isInPlace) return\r\n\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frameProcessId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url,\r\n    }\r\n\r\n    this.sendNavigationEvent('onBeforeNavigate', details)\r\n  }\r\n\r\n  private onCommitted = (\r\n    event: Electron.IpcMainEvent,\r\n    url: string,\r\n    httpResponseCode: number,\r\n    httpStatusText: string,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frameProcessId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url,\r\n    }\r\n    this.sendNavigationEvent('onCommitted', details)\r\n  }\r\n\r\n  private onHistoryStateUpdated = (\r\n    event: Electron.IpcMainEvent,\r\n    url: string,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const details: chrome.webNavigation.WebNavigationTransitionCallbackDetails & {\r\n      parentFrameId: number\r\n    } = {\r\n      transitionType: '', // TODO\r\n      transitionQualifiers: [], // TODO\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frameProcessId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url,\r\n    }\r\n    this.sendNavigationEvent('onHistoryStateUpdated', details)\r\n  }\r\n\r\n  private onDOMContentLoaded = (tab: Electron.WebContents, frame: Electron.WebFrameMain) => {\r\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frame.processId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url: frame.url,\r\n    }\r\n    this.sendNavigationEvent('onDOMContentLoaded', details)\r\n\r\n    if (!tab.isLoadingMainFrame()) {\r\n      this.sendNavigationEvent('onCompleted', details)\r\n    }\r\n  }\r\n\r\n  private onFinishLoad = (\r\n    event: Electron.IpcMainEvent,\r\n    isMainFrame: boolean,\r\n    frameProcessId: number,\r\n    frameRoutingId: number\r\n  ) => {\r\n    const frame = getFrame(frameProcessId, frameRoutingId)\r\n    const tab = event.sender\r\n    const url = tab.getURL()\r\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\r\n      frameId: getFrameId(frame),\r\n      parentFrameId: getParentFrameId(frame),\r\n      processId: frameProcessId,\r\n      tabId: tab.id,\r\n      timeStamp: Date.now(),\r\n      url,\r\n    }\r\n    this.sendNavigationEvent('onCompleted', details)\r\n  }\r\n}\r\n","import path from 'node:path'\r\nimport { parse } from 'node:url'\r\nimport { BrowserWindow } from 'electron'\r\nimport { ExtensionContext } from '../context'\r\nimport { ExtensionEvent } from '../router'\r\nimport { ensureSuffix, unPrefix } from '../utils'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:windows')\r\n\r\nconst getWindowState = (win: BrowserWindow): chrome.windows.Window['state'] => {\r\n  if (win.isMaximized()) return 'maximized'\r\n  if (win.isMinimized()) return 'minimized'\r\n  if (win.isFullScreen()) return 'fullscreen'\r\n  return 'normal'\r\n}\r\n\r\nexport class WindowsAPI {\r\n  static WINDOW_ID_NONE = -1\r\n  static WINDOW_ID_CURRENT = -2\r\n\r\n  constructor(private ctx: ExtensionContext) {\r\n    const handle = this.ctx.router.apiHandler()\r\n    handle('windows.get', this.get.bind(this))\r\n    handle('windows.getCurrent', this.getCurrent.bind(this))\r\n    handle('windows.getLastFocused', this.getLastFocused.bind(this))\r\n    handle('windows.getAll', this.getAll.bind(this))\r\n    handle('windows.create', this.create.bind(this))\r\n    handle('windows.update', this.update.bind(this))\r\n    handle('windows.remove', this.remove.bind(this))\r\n\r\n    this.ctx.store.on('window-added', this.observeWindow.bind(this))\r\n  }\r\n\r\n  private observeWindow(window: Electron.BrowserWindow) {\r\n    if (!window || window.isDestroyed()) {\r\n      debug('observeWindow: window is destroyed');\r\n      return ;\r\n    }\r\n\r\n    const windowId = window.id\r\n\r\n    const onFocus = () => {\r\n      this.onFocusChanged(windowId)\r\n    };\r\n\r\n    const onClosed = () => {\r\n      this.ctx.store.windowDetailsCache.delete(windowId)\r\n      this.ctx.store.removeWindow(window)\r\n      this.onRemoved(windowId)\r\n    };\r\n\r\n    const onRestoreOrMove = () => {\r\n      const details = this.getWindowDetails(window)\r\n      details.state = 'normal';\r\n      this.ctx.store.windowDetailsCache.set(windowId, details)\r\n    };\r\n\r\n    const onMinimize = () => {\r\n      const details = this.getWindowDetails(window)\r\n      details.state = 'minimized';\r\n      this.ctx.store.windowDetailsCache.set(windowId, details)\r\n    };\r\n\r\n    const onMaximize = () => {\r\n      const details = this.getWindowDetails(window)\r\n      details.state = 'maximized';\r\n      this.ctx.store.windowDetailsCache.set(windowId, details)\r\n    };\r\n\r\n    const onEnterFullscreen = () => {\r\n      const details = this.getWindowDetails(window)\r\n      details.state = 'fullscreen';\r\n      this.ctx.store.windowDetailsCache.set(windowId, details)\r\n    };\r\n\r\n    const onLeaveFullscreen = () => {\r\n      const details = this.getWindowDetails(window)\r\n      details.state = getWindowState(window);\r\n      this.ctx.store.windowDetailsCache.set(windowId, details)\r\n    };\r\n    \r\n    window.on('focus', onFocus);\r\n    window.once('closed', onClosed);\r\n    window.on('restore', onRestoreOrMove)\r\n    if (process.platform === 'win32') {\r\n      window.on('moved', onRestoreOrMove)\r\n    }\r\n    window.on('minimize', onMinimize);\r\n    window.on('maximize', onMaximize);\r\n    window.on('enter-full-screen', onEnterFullscreen);\r\n    window.on('enter-html-full-screen', onEnterFullscreen);\r\n    window.on('leave-full-screen', onLeaveFullscreen);\r\n    window.on('leave-html-full-screen', onLeaveFullscreen);\r\n\r\n    this.onCreated(windowId)\r\n\r\n    debug(`Observing window[${windowId}]`)\r\n  }\r\n\r\n  private createWindowDetails(win: BrowserWindow) {\r\n    const details: Partial<chrome.windows.Window> = {\r\n      id: win.id,\r\n      focused: win.isFocused(),\r\n      top: win.getPosition()[1],\r\n      left: win.getPosition()[0],\r\n      width: win.getSize()[0],\r\n      height: win.getSize()[1],\r\n      tabs: Array.from(this.ctx.store.tabs)\r\n        .filter((tab) => {\r\n          const ownerWindow = this.ctx.store.tabToWindow.get(tab)\r\n          return ownerWindow?.isDestroyed() ? false : ownerWindow?.id === win.id\r\n        })\r\n        .map((tab) => this.ctx.store.tabDetailsCache.get(tab.id) as chrome.tabs.Tab)\r\n        .filter(Boolean),\r\n      incognito: !win.webContents.session.isPersistent(),\r\n      type: 'normal', // TODO\r\n      state: getWindowState(win),\r\n      alwaysOnTop: win.isAlwaysOnTop(),\r\n      sessionId: 'default', // TODO\r\n    }\r\n\r\n    this.ctx.store.windowDetailsCache.set(win.id, details)\r\n    return details\r\n  }\r\n\r\n  private getWindowDetails(win: BrowserWindow) {\r\n    if (this.ctx.store.windowDetailsCache.has(win.id)) {\r\n      return this.ctx.store.windowDetailsCache.get(win.id)!\r\n    }\r\n    const details = this.createWindowDetails(win)\r\n    return details\r\n  }\r\n\r\n  private async getWindowFromId(event: ExtensionEvent, id: number) {\r\n    if (id === WindowsAPI.WINDOW_ID_CURRENT) {\r\n      return (await this.ctx.store.windowsGetCurrent(event))\r\n        || this.ctx.store.getLastFocusedWindow()\r\n    } else {\r\n      return this.ctx.store.getWindowById(event, id)\r\n    }\r\n  }\r\n\r\n  private async get(event: ExtensionEvent, windowId: number) {\r\n    let win: Electron.BrowserWindow | null;\r\n    if (windowId === WindowsAPI.WINDOW_ID_CURRENT) {\r\n      win = await this.ctx.store.windowsGetCurrent(event) || this.ctx.store.getLastFocusedWindow() || null;\r\n    } else {\r\n      win = await this.getWindowFromId(event, windowId) || null;\r\n    }\r\n    if (!win) return { id: WindowsAPI.WINDOW_ID_NONE }\r\n    return this.getWindowDetails(win)\r\n  }\r\n\r\n  private getLastFocused(event: ExtensionEvent) {\r\n    const win = this.ctx.store.getLastFocusedWindow()\r\n    return win ? this.getWindowDetails(win) : null\r\n  }\r\n\r\n  // not same with `getLastFocused`, `getCurrent` means the host window where javascript executing\r\n  private async getCurrent(event: ExtensionEvent) {\r\n    const win = await this.ctx.store.windowsGetCurrent(event);\r\n\r\n    return win ? this.getWindowDetails(win) : null\r\n  }\r\n\r\n  private getAll(event: ExtensionEvent) {\r\n    return Array.from(this.ctx.store.windows).map(this.getWindowDetails.bind(this))\r\n  }\r\n\r\n  private async create(event: ExtensionEvent, details: chrome.windows.CreateData) {\r\n    const baseURL = ensureSuffix(event.extension.url, '/');\r\n\r\n    let url = Array.isArray(details.url) ? details.url[0] : details.url || ''\r\n\r\n    const urlInfo = parse(url);\r\n\r\n    if (!urlInfo.protocol && !urlInfo.hostname) {\r\n      url = baseURL + unPrefix(url, ['./', '/']);\r\n    } else if (!urlInfo.hostname) {\r\n      url = baseURL + unPrefix(url, ['./', '/']);\r\n    }\r\n    \r\n    const win = await this.ctx.store.createWindow(event, {...details, url})\r\n    return this.getWindowDetails(win)\r\n  }\r\n\r\n  private async update(\r\n    event: ExtensionEvent,\r\n    windowId: number,\r\n    updateProperties: chrome.windows.UpdateInfo = {}\r\n  ) {\r\n    const win = await this.getWindowFromId(event, windowId)\r\n    if (!win) return\r\n\r\n    const props = updateProperties\r\n\r\n    if (props.state) {\r\n      switch (props.state) {\r\n        case 'maximized':\r\n          win.maximize()\r\n          break\r\n        case 'minimized':\r\n          win.minimize()\r\n          break\r\n        case 'fullscreen':\r\n          if (win.fullScreenable) win.setFullScreen(true)\r\n          else {\r\n            console.warn('window is not fullScreenable')\r\n          }\r\n          break\r\n        case 'normal': {\r\n          if (win.isFullScreen()) {\r\n            win.setFullScreen(false)\r\n          } else if (win.isMinimized() || win.isMaximized()) {\r\n            win.restore()\r\n          }\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.createWindowDetails(win)\r\n  }\r\n\r\n  private async remove(event: ExtensionEvent, windowId: number = WindowsAPI.WINDOW_ID_CURRENT) {\r\n    const win = await this.getWindowFromId(event, windowId)\r\n    if (!win) return\r\n    const removedWindowId = win.id\r\n    await this.ctx.store.removeWindow(win)\r\n    this.onRemoved(removedWindowId)\r\n  }\r\n\r\n  onCreated(windowId: number) {\r\n    const window = this.ctx.store.findWindowById(windowId)\r\n    if (!window) return\r\n    const windowDetails = this.getWindowDetails(window)\r\n    this.ctx.router.broadcastEvent('windows.onCreated', windowDetails)\r\n  }\r\n\r\n  onRemoved(windowId: number) {\r\n    this.ctx.router.broadcastEvent('windows.onRemoved', windowId)\r\n  }\r\n\r\n  onFocusChanged(windowId: number) {\r\n    if (this.ctx.store.lastFocusedWindowId === windowId) return\r\n\r\n    this.ctx.store.lastFocusedWindowId = windowId\r\n    this.ctx.router.broadcastEvent('windows.onFocusChanged', windowId)\r\n  }\r\n}\r\n","import { app, session as electronSession } from 'electron'\r\nimport { EventEmitter } from 'events'\r\nimport path from 'path'\r\nimport { promises as fs } from 'fs'\r\n\r\nimport { BrowserActionAPI } from './api/browser-action'\r\nimport { TabsAPI } from './api/tabs'\r\nimport { WindowsAPI } from './api/windows'\r\nimport { WebNavigationAPI } from './api/web-navigation'\r\nimport { ExtensionStore } from './store'\r\nimport { ContextMenusAPI } from './api/context-menus'\r\nimport { RuntimeAPI } from './api/runtime'\r\nimport { CookiesAPI } from './api/cookies'\r\nimport { NotificationsAPI } from './api/notifications'\r\nimport { ChromeExtensionImpl } from './impl'\r\nimport { CommandsAPI } from './api/commands'\r\nimport { ExtensionContext } from './context'\r\nimport { ExtensionRouter } from './router'\r\n\r\nexport interface ChromeExtensionOptions extends ChromeExtensionImpl {\r\n  session?: Electron.Session\r\n\r\n  /**\r\n   * Path to electron-chrome-extensions module files. Might be needed if\r\n   * JavaScript bundlers like Webpack are used in your build process.\r\n   */\r\n  modulePath?: string\r\n  /**\r\n   * if not provided, default <modulePath>/dist/js\r\n   */\r\n  preloadPath?: string\r\n}\r\n\r\nconst sessionMap = new WeakMap<Electron.Session, ElectronChromeExtensions>()\r\n\r\n/**\r\n * Provides an implementation of various Chrome extension APIs to a session.\r\n */\r\nexport class ElectronChromeExtensions extends EventEmitter {\r\n  /** Retrieve an instance of this class associated with the given session. */\r\n  static fromSession(session: Electron.Session) {\r\n    return sessionMap.get(session)\r\n  }\r\n\r\n  private ctx: ExtensionContext\r\n  private modulePath: string\r\n  private preloadPath: string\r\n\r\n  private api: {\r\n    browserAction: BrowserActionAPI\r\n    contextMenus: ContextMenusAPI\r\n    commands: CommandsAPI\r\n    cookies: CookiesAPI\r\n    notifications: NotificationsAPI\r\n    runtime: RuntimeAPI\r\n    tabs: TabsAPI\r\n    webNavigation: WebNavigationAPI\r\n    windows: WindowsAPI\r\n  }\r\n\r\n  constructor(opts?: ChromeExtensionOptions) {\r\n    super()\r\n\r\n    const { session = electronSession.defaultSession, modulePath, preloadPath, ...impl } = opts || {}\r\n\r\n    if (sessionMap.has(session)) {\r\n      throw new Error(`Extensions instance already exists for the given session`)\r\n    }\r\n\r\n    sessionMap.set(session, this)\r\n\r\n    const router = new ExtensionRouter(session)\r\n    const store = new ExtensionStore(impl)\r\n\r\n    this.ctx = {\r\n      emit: this.emit.bind(this),\r\n      router,\r\n      session,\r\n      store,\r\n    }\r\n\r\n    this.modulePath = modulePath || path.join(__dirname, '..');\r\n    this.preloadPath = preloadPath || '';\r\n\r\n    this.api = {\r\n      browserAction: new BrowserActionAPI(this.ctx),\r\n      contextMenus: new ContextMenusAPI(this.ctx),\r\n      commands: new CommandsAPI(this.ctx),\r\n      cookies: new CookiesAPI(this.ctx),\r\n      notifications: new NotificationsAPI(this.ctx),\r\n      runtime: new RuntimeAPI(this.ctx),\r\n      tabs: new TabsAPI(this.ctx),\r\n      webNavigation: new WebNavigationAPI(this.ctx),\r\n      windows: new WindowsAPI(this.ctx),\r\n    }\r\n\r\n    this.prependPreload()\r\n  }\r\n\r\n  private async prependPreload() {\r\n    const { session } = this.ctx\r\n    let preloads = session.getPreloads()\r\n\r\n    const preloadPath = this.preloadPath || path.join(this.modulePath, 'dist/preload.js');\r\n\r\n    const preloadIndex = preloads.indexOf(preloadPath)\r\n    if (preloadIndex > -1) {\r\n      preloads.splice(preloadIndex, 1)\r\n    }\r\n\r\n    preloads = [preloadPath, ...preloads]\r\n    session.setPreloads(preloads)\r\n\r\n    let preloadExists = false\r\n    try {\r\n      const stat = await fs.stat(preloadPath)\r\n      preloadExists = stat.isFile()\r\n    } catch {}\r\n\r\n    if (!preloadExists) {\r\n      console.error(\r\n        `Unable to access electron-chrome-extensions preload file (${preloadPath}). Consider configuring the 'modulePath' constructor option.`\r\n      )\r\n    }\r\n  }\r\n\r\n  /** Add webContents to be tracked as a tab. */\r\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\r\n    this.ctx.store.addTab(tab, window)\r\n  }\r\n\r\n  /** Add window created outside/before extensions initialized */\r\n  addWindow(window: Electron.BrowserWindow) {\r\n    this.ctx.store.addWindow(window)\r\n  }\r\n\r\n  /** Notify extension system that the active tab has changed. */\r\n  selectTab(tab: Electron.WebContents) {\r\n    if (this.ctx.store.tabs.has(tab)) {\r\n      this.api.tabs.onActivated(tab.id)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add webContents to be tracked as an extension host which will receive\r\n   * extension events when a chrome-extension:// resource is loaded.\r\n   *\r\n   * This is usually reserved for extension background pages and popups, but\r\n   * can also be used in other special cases.\r\n   *\r\n   * @deprecated Extension hosts are now tracked lazily when they send\r\n   * extension IPCs to the main process.\r\n   */\r\n  addExtensionHost(host: Electron.WebContents) {\r\n    console.warn('ElectronChromeExtensions.addExtensionHost() is deprecated')\r\n  }\r\n\r\n  /**\r\n   * Get collection of menu items managed by the `chrome.contextMenus` API.\r\n   * @see https://developer.chrome.com/extensions/contextMenus\r\n   */\r\n  getContextMenuItems(webContents: Electron.WebContents, params: Electron.ContextMenuParams) {\r\n    return this.api.contextMenus.buildMenuItemsForParams(webContents, params)\r\n  }\r\n\r\n  /**\r\n   * Add extensions to be visible as an extension action button.\r\n   *\r\n   * @deprecated Not needed in Electron >=12.\r\n   */\r\n  addExtension(extension: Electron.Extension) {\r\n    console.warn('ElectronChromeExtensions.addExtension() is deprecated')\r\n    this.api.browserAction.processExtension(extension)\r\n  }\r\n\r\n  /**\r\n   * Remove extensions from the list of visible extension action buttons.\r\n   *\r\n   * @deprecated Not needed in Electron >=12.\r\n   */\r\n  removeExtension(extension: Electron.Extension) {\r\n    console.warn('ElectronChromeExtensions.removeExtension() is deprecated')\r\n    this.api.browserAction.removeActions(extension.id)\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use `ElectronChromeExtensions` instead.\r\n */\r\nexport const Extensions = ElectronChromeExtensions\r\n","import { BrowserWindow, Session } from 'electron'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:popup')\r\n\r\nexport interface PopupAnchorRect {\r\n  x: number\r\n  y: number\r\n  width: number\r\n  height: number\r\n}\r\n\r\ninterface PopupViewOptions {\r\n  extensionId: string\r\n  session: Session\r\n  parent: BrowserWindow\r\n  url: string\r\n  anchorRect: PopupAnchorRect\r\n}\r\n\r\nexport class PopupView {\r\n  static POSITION_PADDING = 5\r\n\r\n  static BOUNDS = {\r\n    minWidth: 25,\r\n    minHeight: 25,\r\n    maxWidth: 800,\r\n    maxHeight: 600,\r\n  }\r\n\r\n  browserWindow?: BrowserWindow\r\n  parent?: BrowserWindow\r\n  extensionId: string\r\n\r\n  private anchorRect: PopupAnchorRect\r\n  private destroyed: boolean = false\r\n\r\n  /** Preferred size changes are only received in Electron v12+ */\r\n  private usingPreferredSize = false\r\n\r\n  private readyPromise: Promise<void>\r\n\r\n  constructor(opts: PopupViewOptions) {\r\n    this.parent = opts.parent\r\n    this.extensionId = opts.extensionId\r\n    this.anchorRect = opts.anchorRect\r\n\r\n    this.browserWindow = new BrowserWindow({\r\n      show: false,\r\n      frame: false,\r\n      parent: opts.parent,\r\n      movable: false,\r\n      maximizable: false,\r\n      minimizable: false,\r\n      resizable: false,\r\n      skipTaskbar: true,\r\n      backgroundColor: '#ffffff',\r\n      webPreferences: {\r\n        session: opts.session,\r\n        sandbox: true,\r\n        nodeIntegration: false,\r\n        nodeIntegrationInWorker: false,\r\n        nativeWindowOpen: true,\r\n        worldSafeExecuteJavaScript: true,\r\n        contextIsolation: true,\r\n        ...({\r\n          enablePreferredSizeMode: true,\r\n        } as any),\r\n      },\r\n    })\r\n\r\n    const untypedWebContents = this.browserWindow.webContents as any\r\n    untypedWebContents.on('preferred-size-changed', this.updatePreferredSize)\r\n\r\n    this.browserWindow.webContents.on('devtools-closed', this.maybeClose)\r\n    this.browserWindow.on('blur', this.maybeClose)\r\n    this.browserWindow.on('closed', this.destroy)\r\n    this.parent.once('closed', this.destroy)\r\n\r\n    this.readyPromise = this.load(opts.url)\r\n  }\r\n\r\n  private async load(url: string): Promise<void> {\r\n    const win = this.browserWindow!\r\n\r\n    try {\r\n      await win.webContents.loadURL(url)\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n\r\n    if (this.destroyed) return\r\n\r\n    if (!this.usingPreferredSize) {\r\n      // Set large initial size to avoid overflow\r\n      this.setSize({ width: PopupView.BOUNDS.maxWidth, height: PopupView.BOUNDS.maxHeight })\r\n\r\n      // Wait for content and layout to load\r\n      await new Promise((resolve) => setTimeout(resolve, 100))\r\n      if (this.destroyed) return\r\n\r\n      await this.queryPreferredSize()\r\n      if (this.destroyed) return\r\n    }\r\n\r\n    win.show()\r\n  }\r\n\r\n  destroy = () => {\r\n    if (this.destroyed) return\r\n\r\n    this.destroyed = true\r\n\r\n    debug(`destroying ${this.extensionId}`)\r\n\r\n    if (this.parent) {\r\n      if (!this.parent.isDestroyed()) {\r\n        this.parent.off('closed', this.destroy)\r\n      }\r\n      this.parent = undefined\r\n    }\r\n\r\n    if (this.browserWindow) {\r\n      if (!this.browserWindow.isDestroyed()) {\r\n        const { webContents } = this.browserWindow\r\n\r\n        if (!webContents.isDestroyed() && webContents.isDevToolsOpened()) {\r\n          webContents.closeDevTools()\r\n        }\r\n\r\n        this.browserWindow.off('closed', this.destroy)\r\n        this.browserWindow.destroy()\r\n      }\r\n\r\n      this.browserWindow = undefined\r\n    }\r\n  }\r\n\r\n  isDestroyed() {\r\n    return this.destroyed\r\n  }\r\n\r\n  /** Resolves when the popup finishes loading. */\r\n  whenReady() {\r\n    return this.readyPromise\r\n  }\r\n\r\n  setSize(rect: Partial<Electron.Rectangle>) {\r\n    if (!this.browserWindow || !this.parent) return\r\n\r\n    const width = Math.floor(\r\n      Math.min(PopupView.BOUNDS.maxWidth, Math.max(rect.width || 0, PopupView.BOUNDS.minWidth))\r\n    )\r\n\r\n    const height = Math.floor(\r\n      Math.min(PopupView.BOUNDS.maxHeight, Math.max(rect.height || 0, PopupView.BOUNDS.minHeight))\r\n    )\r\n\r\n    debug(`setSize`, { width, height })\r\n\r\n    this.browserWindow?.setBounds({\r\n      ...this.browserWindow.getBounds(),\r\n      width,\r\n      height,\r\n    })\r\n  }\r\n\r\n  private maybeClose = () => {\r\n    // Keep open if webContents is being inspected\r\n    if (!this.browserWindow?.isDestroyed() && this.browserWindow?.webContents.isDevToolsOpened()) {\r\n      debug('preventing close due to DevTools being open')\r\n      return\r\n    }\r\n\r\n    // For extension popups with a login form, the user may need to access a\r\n    // program outside of the app. Closing the popup would then add\r\n    // inconvenience.\r\n    if (!BrowserWindow.getFocusedWindow()) {\r\n      debug('preventing close due to focus residing outside of the app')\r\n      return\r\n    }\r\n\r\n    this.destroy()\r\n  }\r\n\r\n  private updatePosition() {\r\n    if (!this.browserWindow || !this.parent) return\r\n\r\n    const winBounds = this.parent.getBounds()\r\n    const viewBounds = this.browserWindow.getBounds()\r\n\r\n    // TODO: support more orientations than just top-right\r\n    let x = winBounds.x + this.anchorRect.x + this.anchorRect.width - viewBounds.width\r\n    let y = winBounds.y + this.anchorRect.y + this.anchorRect.height + PopupView.POSITION_PADDING\r\n\r\n    // Convert to ints\r\n    x = Math.floor(x)\r\n    y = Math.floor(y)\r\n\r\n    debug(`updatePosition`, { x, y })\r\n\r\n    this.browserWindow.setBounds({\r\n      ...this.browserWindow.getBounds(),\r\n      x,\r\n      y,\r\n    })\r\n  }\r\n\r\n  /** Backwards compat for Electron <12 */\r\n  private async queryPreferredSize() {\r\n    if (this.usingPreferredSize || this.destroyed) return\r\n\r\n    const rect = await this.browserWindow!.webContents.executeJavaScript(\r\n      `((${() => {\r\n        const rect = document.body.getBoundingClientRect()\r\n        return { width: rect.width, height: rect.height }\r\n      }})())`\r\n    )\r\n\r\n    if (this.destroyed) return\r\n\r\n    this.setSize({ width: rect.width, height: rect.height })\r\n    this.updatePosition()\r\n  }\r\n\r\n  private updatePreferredSize = (event: Electron.Event, size: Electron.Size) => {\r\n    debug('updatePreferredSize', size)\r\n    this.usingPreferredSize = true\r\n    this.setSize(size)\r\n    this.updatePosition()\r\n  }\r\n}\r\n","import { app, Extension, ipcMain, session, Session, WebContents } from 'electron'\r\n\r\nimport createDebug from 'debug'\r\nimport { formatIpcName } from '../isomorphic/ipc'\r\n\r\n// Shorten base64 encoded icons\r\nconst shortenValues = (k: string, v: any) =>\r\n  typeof v === 'string' && v.length > 128 ? v.substr(0, 128) + '...' : v\r\n\r\ncreateDebug.formatters.r = (value: any) => {\r\n  return value ? JSON.stringify(value, shortenValues, '  ') : value\r\n}\r\n\r\nconst debug = createDebug('electron-chrome-extensions:router')\r\n\r\nconst DEFAULT_SESSION = '_self'\r\n\r\ninterface RoutingDelegateObserver {\r\n  session: Electron.Session\r\n  onExtensionMessage(\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string | undefined,\r\n    handlerName: string,\r\n    ...args: any[]\r\n  ): Promise<void>\r\n  addListener(listener: EventListener, extensionId: string, eventName: string): void\r\n  removeListener(listener: EventListener, extensionId: string, eventName: string): void\r\n}\r\n\r\nlet gRoutingDelegate: RoutingDelegate\r\n\r\n/**\r\n * Handles event routing IPCs and delivers them to the observer with the\r\n * associated session.\r\n */\r\nclass RoutingDelegate {\r\n  static get() {\r\n    return gRoutingDelegate || (gRoutingDelegate = new RoutingDelegate())\r\n  }\r\n\r\n  private sessionMap: WeakMap<Session, RoutingDelegateObserver> = new WeakMap()\r\n\r\n  private constructor() {\r\n    ipcMain.handle('crx-msg', this.onRouterMessage)\r\n    ipcMain.handle('crx-msg-remote', this.onRemoteMessage)\r\n    ipcMain.on('crx-add-listener', this.onAddListener)\r\n    ipcMain.on('crx-remove-listener', this.onRemoveListener)\r\n  }\r\n\r\n  addObserver(observer: RoutingDelegateObserver) {\r\n    this.sessionMap.set(observer.session, observer)\r\n  }\r\n\r\n  private onRouterMessage = async (\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string,\r\n    handlerName: string,\r\n    ...args: any[]\r\n  ) => {\r\n    debug(`received '${handlerName}'`, args)\r\n\r\n    const observer = this.sessionMap.get(event.sender.session)\r\n\r\n    return observer?.onExtensionMessage(event, extensionId, handlerName, ...args)\r\n  }\r\n\r\n  private onRemoteMessage = async (\r\n    event: Electron.IpcMainInvokeEvent,\r\n    sessionPartition: string,\r\n    handlerName: string,\r\n    ...args: any[]\r\n  ) => {\r\n    debug(`received remote '${handlerName}' for '${sessionPartition}'`, args)\r\n\r\n    const ses =\r\n      sessionPartition === DEFAULT_SESSION\r\n        ? event.sender.session\r\n        : session.fromPartition(sessionPartition)\r\n\r\n    const observer = this.sessionMap.get(ses)\r\n\r\n    return observer?.onExtensionMessage(event, undefined, handlerName, ...args)\r\n  }\r\n\r\n  private onAddListener = (\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string,\r\n    eventName: string\r\n  ) => {\r\n    const observer = this.sessionMap.get(event.sender.session)\r\n    const listener: EventListener = { host: event.sender, extensionId }\r\n    return observer?.addListener(listener, extensionId, eventName)\r\n  }\r\n\r\n  private onRemoveListener = (\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string,\r\n    eventName: string\r\n  ) => {\r\n    const observer = this.sessionMap.get(event.sender.session)\r\n    const listener: EventListener = { host: event.sender, extensionId }\r\n    return observer?.removeListener(listener, extensionId, eventName)\r\n  }\r\n}\r\n\r\nexport interface ExtensionEvent {\r\n  sender: WebContents\r\n  extension: Extension\r\n}\r\n\r\nexport type HandlerCallback = (event: ExtensionEvent, ...args: any[]) => any\r\n\r\nexport interface HandlerOptions {\r\n  /** Whether the handler can be invoked on behalf of a different session. */\r\n  allowRemote?: boolean\r\n  /** Whether an extension context is required to invoke the handler. */\r\n  extensionContext: boolean\r\n}\r\n\r\ninterface Handler extends HandlerOptions {\r\n  callback: HandlerCallback\r\n}\r\n\r\n/** e.g. 'tabs.query' */\r\ntype EventName = string\r\n\r\ntype HandlerMap = Map<EventName, Handler>\r\n\r\ninterface EventListener {\r\n  host: Electron.WebContents\r\n  extensionId: string\r\n}\r\n\r\nconst eventListenerEquals = (eventListener: EventListener) => (other: EventListener) =>\r\n  other.host === eventListener.host && other.extensionId === eventListener.extensionId\r\n\r\nexport class ExtensionRouter implements RoutingDelegateObserver {\r\n  private handlers: HandlerMap = new Map()\r\n  private listeners: Map<EventName, EventListener[]> = new Map()\r\n\r\n  /**\r\n   * Collection of all extension hosts in the session.\r\n   *\r\n   * Currently the router has no ability to wake up non-persistent background\r\n   * scripts to deliver events. For now we just hold a reference to them to\r\n   * prevent them from being terminated.\r\n   */\r\n  private extensionHosts: Set<Electron.WebContents> = new Set()\r\n\r\n  constructor(\r\n    public session: Electron.Session,\r\n    private delegate: RoutingDelegate = RoutingDelegate.get()\r\n  ) {\r\n    this.delegate.addObserver(this)\r\n\r\n    session.on('extension-unloaded', (event, extension) => {\r\n      this.filterListeners((listener) => listener.extensionId !== extension.id)\r\n    })\r\n\r\n    app.on('web-contents-created', (event, webContents) => {\r\n      if (webContents.session === this.session && webContents.getType() === 'backgroundPage') {\r\n        debug(`storing reference to background host [url:'${webContents.getURL()}']`)\r\n        this.extensionHosts.add(webContents)\r\n      }\r\n    })\r\n  }\r\n\r\n  private filterListeners(predicate: (listener: EventListener) => boolean) {\r\n    for (const [eventName, listeners] of this.listeners) {\r\n      const filteredListeners = listeners.filter(predicate)\r\n      const delta = listeners.length - filteredListeners.length\r\n\r\n      if (filteredListeners.length > 0) {\r\n        this.listeners.set(eventName, filteredListeners)\r\n      } else {\r\n        this.listeners.delete(eventName)\r\n      }\r\n\r\n      if (delta > 0) {\r\n        debug(`removed ${delta} listener(s) for '${eventName}'`)\r\n      }\r\n    }\r\n  }\r\n\r\n  private observeListenerHost(host: EventListener['host']) {\r\n    debug(`observing listener [id:${host.id}, url:'${host.getURL()}']`)\r\n    host.once('destroyed', () => {\r\n      debug(`extension host destroyed [id:${host.id}]`)\r\n      this.filterListeners((listener) => listener.host !== host)\r\n    })\r\n  }\r\n\r\n  addListener(listener: EventListener, extensionId: string, eventName: string) {\r\n    const { listeners, session } = this\r\n\r\n    const extension = session.getExtension(extensionId)\r\n    if (!extension) {\r\n      throw new Error(`extension not registered in session [extensionId:${extensionId}]`)\r\n    }\r\n\r\n    if (!listeners.has(eventName)) {\r\n      listeners.set(eventName, [])\r\n    }\r\n\r\n    const eventListeners = listeners.get(eventName)!\r\n    const existingEventListener = eventListeners.find(eventListenerEquals(listener))\r\n\r\n    if (existingEventListener) {\r\n      debug(`ignoring existing '${eventName}' event listener for ${extensionId}`)\r\n    } else {\r\n      debug(`adding '${eventName}' event listener for ${extensionId}`)\r\n      eventListeners.push(listener)\r\n      this.observeListenerHost(listener.host)\r\n    }\r\n  }\r\n\r\n  removeListener(listener: EventListener, extensionId: string, eventName: string) {\r\n    const { listeners } = this\r\n\r\n    const eventListeners = listeners.get(eventName)\r\n    if (!eventListeners) {\r\n      console.error(`event listener not registered for '${eventName}'`)\r\n      return\r\n    }\r\n\r\n    const index = eventListeners.findIndex(eventListenerEquals(listener))\r\n\r\n    if (index >= 0) {\r\n      debug(`removing '${eventName}' event listener for ${extensionId}`)\r\n      eventListeners.splice(index, 1)\r\n    }\r\n\r\n    if (eventListeners.length === 0) {\r\n      listeners.delete(eventName)\r\n    }\r\n  }\r\n\r\n  private getHandler(handlerName: string) {\r\n    const handler = this.handlers.get(handlerName)\r\n    if (!handler) {\r\n      throw new Error(`${handlerName} is not a registered handler`)\r\n    }\r\n\r\n    return handler\r\n  }\r\n\r\n  async onExtensionMessage(\r\n    event: Electron.IpcMainInvokeEvent,\r\n    extensionId: string | undefined,\r\n    handlerName: string,\r\n    ...args: any[]\r\n  ) {\r\n    const { session } = this\r\n    const { sender } = event\r\n    const handler = this.getHandler(handlerName)\r\n\r\n    if (sender.session !== session && !handler.allowRemote) {\r\n      throw new Error(`${handlerName} does not support calling from a remote session`)\r\n    }\r\n\r\n    const extension = extensionId ? sender.session.getExtension(extensionId) : undefined\r\n    if (!extension && handler.extensionContext) {\r\n      throw new Error(`${handlerName} was sent from an unknown extension context`)\r\n    }\r\n\r\n    const extEvent = {\r\n      sender,\r\n      extension: extension!,\r\n    }\r\n\r\n    const result = await handler.callback(extEvent, ...args)\r\n\r\n    debug(`${handlerName} result: %r`, result)\r\n\r\n    return result\r\n  }\r\n\r\n  private handle(name: string, callback: HandlerCallback, opts?: HandlerOptions): void {\r\n    this.handlers.set(name, {\r\n      callback,\r\n      extensionContext: typeof opts?.extensionContext === 'boolean' ? opts.extensionContext : true,\r\n      allowRemote: typeof opts?.allowRemote === 'boolean' ? opts.allowRemote : false,\r\n    })\r\n  }\r\n\r\n  /** Returns a callback to register API handlers for the given context. */\r\n  apiHandler() {\r\n    return (name: string, callback: HandlerCallback, opts?: HandlerOptions) => {\r\n      this.handle(name, callback, opts)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sends extension event to the host for the given extension ID if it\r\n   * registered a listener for it.\r\n   */\r\n  sendEvent(extensionId: string | undefined, eventName: string, ...args: any[]) {\r\n    const { listeners } = this\r\n\r\n    let eventListeners = listeners.get(eventName)\r\n\r\n    if (extensionId) {\r\n      // TODO: extension permissions check\r\n      debug(`sendEvent '${eventName}' to extension '${extensionId}'`)\r\n      eventListeners = eventListeners?.filter((el) => el.extensionId === extensionId)\r\n    } else {\r\n      debug(`broadcast event '${eventName}' to all extensions`)\r\n    }\r\n\r\n    if (!eventListeners || eventListeners.length === 0) {\r\n      debug(`ignoring '${eventName}' event with no listeners`)\r\n      return\r\n    }\r\n\r\n    for (const { host } of eventListeners) {\r\n      // TODO: may need to wake lazy extension context\r\n      if (host.isDestroyed()) {\r\n        console.error(`Unable to send '${eventName}' to extension host for ${extensionId}`)\r\n        continue\r\n      }\r\n\r\n      host.send(formatIpcName(eventName), ...args)\r\n    }\r\n  }\r\n\r\n  /** Broadcasts extension event to all extension hosts listening for it. */\r\n  broadcastEvent(eventName: string, ...args: any[]) {\r\n    this.sendEvent(undefined, eventName, ...args)\r\n  }\r\n}\r\n","import { BrowserWindow, webContents } from 'electron'\r\nimport { EventEmitter } from 'events'\r\nimport { ContextMenuType } from './api/common'\r\nimport { ChromeExtensionImpl } from './impl'\r\nimport { ExtensionEvent } from './router'\r\n\r\nconst debug = require('debug')('electron-chrome-extensions:store')\r\n\r\nexport class ExtensionStore extends EventEmitter {\r\n  /** Tabs observed by the extensions system. */\r\n  tabs = new Set<Electron.WebContents>()\r\n\r\n  /** Windows observed by the extensions system. */\r\n  windows = new Set<Electron.BrowserWindow>()\r\n\r\n  lastFocusedWindowId?: number\r\n\r\n  /**\r\n   * Map of tabs to their parent window.\r\n   *\r\n   * It's not possible to access the parent of a BrowserView so we must manage\r\n   * this ourselves.\r\n   */\r\n  tabToWindow = new WeakMap<Electron.WebContents, Electron.BrowserWindow>()\r\n\r\n  /** Map of windows to their active tab. */\r\n  private windowToActiveTab = new WeakMap<Electron.BrowserWindow, Electron.WebContents>()\r\n\r\n  tabDetailsCache = new Map<number, Partial<chrome.tabs.Tab>>()\r\n  windowDetailsCache = new Map<number, Partial<chrome.windows.Window>>()\r\n\r\n  constructor(public impl: ChromeExtensionImpl) {\r\n    super()\r\n  }\r\n\r\n  async getWindowById(event: ExtensionEvent, windowId: number) {\r\n    const foundWindow = this.findWindowById(windowId);\r\n    const window = this.impl.getWindowById?.({ event, foundWindow }, windowId)\r\n\r\n    return window || foundWindow || null;\r\n  }\r\n\r\n  findWindowById(windowId: number) {\r\n    return Array.from(this.windows).find(\r\n      (window) => !window.isDestroyed() && window.id === windowId\r\n    )\r\n  }\r\n\r\n  getLastFocusedWindow() {\r\n    return this.lastFocusedWindowId ? this.findWindowById(this.lastFocusedWindowId) : null\r\n  }\r\n\r\n  addWindow(window: Electron.BrowserWindow) {\r\n    if (this.windows.has(window)) return\r\n\r\n    this.windows.add(window)\r\n\r\n    if (typeof this.lastFocusedWindowId !== 'number') {\r\n      this.lastFocusedWindowId = window.id\r\n    }\r\n\r\n    this.emit('window-added', window)\r\n  }\r\n\r\n  async windowsGetCurrent(event: ExtensionEvent) {\r\n    const wc = event.sender;\r\n    let win = this.tabToWindow.get(wc) || BrowserWindow.fromWebContents(wc);\r\n    if (typeof this.impl.windowsGetCurrent === 'function') {\r\n      const lastFocusedWindow = this.getLastFocusedWindow() || null;\r\n      win = await this.impl.windowsGetCurrent(win, {\r\n        event,\r\n        lastFocusedWindow\r\n      });\r\n    }\r\n\r\n    return win;\r\n  }\r\n\r\n  async createWindow(event: ExtensionEvent, details: chrome.windows.CreateData) {\r\n    if (typeof this.impl.createWindow !== 'function') {\r\n      throw new Error('createWindow is not implemented')\r\n    }\r\n\r\n    const win = await this.impl.createWindow(details, { event })\r\n\r\n    this.addWindow(win)\r\n\r\n    return win\r\n  }\r\n\r\n  removeWindow(window: Electron.BrowserWindow) {\r\n    if (!this.windows.has(window)) return\r\n\r\n    this.windows.delete(window)\r\n\r\n    if (typeof this.impl.removeWindow === 'function') {\r\n      this.impl.removeWindow(window)\r\n    } else {\r\n      window.destroy()\r\n    }\r\n  }\r\n\r\n  getTabById(tabId: number) {\r\n    return Array.from(this.tabs).find((tab) => !tab.isDestroyed() && tab.id === tabId)\r\n  }\r\n\r\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\r\n    if (this.tabs.has(tab)) return\r\n\r\n    this.tabs.add(tab)\r\n    this.tabToWindow.set(tab, window)\r\n    this.addWindow(window)\r\n\r\n    const activeTab = this.getActiveTabFromWebContents(tab)\r\n    if (!activeTab) {\r\n      this.setActiveTab(tab)\r\n    }\r\n\r\n    this.emit('tab-added', tab)\r\n  }\r\n\r\n  removeTab(tab: Electron.WebContents) {\r\n    if (!this.tabs.has(tab)) return\r\n\r\n    const tabId = tab.id\r\n    const win = this.tabToWindow.get(tab)!\r\n\r\n    this.tabs.delete(tab)\r\n    this.tabToWindow.delete(tab)\r\n\r\n    // TODO: clear active tab\r\n\r\n    ;(async () => {\r\n      const behaviors = await this.impl.getTabbedBrowserWindowBehavior?.({ tabs: this.tabs, window: win })\r\n      // Clear window if it has no remaining tabs\r\n      const windowHasTabs = Array.from(this.tabs).find((tab) => this.tabToWindow.get(tab) === win)\r\n      if (!windowHasTabs && !behaviors?.keepRefWindowOnAllTabsClosed) {\r\n        // TODO: maybe we should check if windows destroyed to determine if we should dispose all listeners on it.\r\n        this.windows.delete(win);\r\n      }\r\n  \r\n      if (typeof this.impl.removeTab === 'function') {\r\n        this.impl.removeTab(tab, win)\r\n      }\r\n  \r\n      this.emit('tab-removed', tabId);\r\n    })();\r\n  }\r\n\r\n  async createTab(details: chrome.tabs.CreateProperties, event: ExtensionEvent) {\r\n    if (typeof this.impl.createTab !== 'function') {\r\n      throw new Error('createTab is not implemented')\r\n    }\r\n\r\n    // Fallback to current window\r\n    if (!details.windowId) {\r\n      details.windowId = this.lastFocusedWindowId\r\n    }\r\n\r\n    const result = await this.impl.createTab(details, { event })\r\n    if (!result) return result;\r\n\r\n    if (!Array.isArray(result)) {\r\n      throw new Error('createTab must return an array of [tab, window]')\r\n    }\r\n\r\n    const [tab, window] = result\r\n\r\n    if (typeof tab !== 'object' || !webContents.fromId(tab.id)) {\r\n      throw new Error('createTab must return a WebContents')\r\n    } else if (typeof window !== 'object') {\r\n      throw new Error('createTab must return a BrowserWindow')\r\n    }\r\n\r\n    this.addTab(tab, window)\r\n\r\n    return tab\r\n  }\r\n\r\n  getActiveTabFromWindow(win: Electron.BrowserWindow) {\r\n    const activeTab = win && !win.isDestroyed() && this.windowToActiveTab.get(win)\r\n    return (activeTab && !activeTab.isDestroyed() && activeTab) || undefined\r\n  }\r\n\r\n  getActiveTabFromWebContents(wc: Electron.WebContents): Electron.WebContents | undefined {\r\n    const win = this.tabToWindow.get(wc) || BrowserWindow.fromWebContents(wc)\r\n    return win ? this.getActiveTabFromWindow(win) : undefined\r\n  }\r\n\r\n  getActiveTabOfCurrentWindow() {\r\n    const win = this.getLastFocusedWindow()\r\n    return win ? this.getActiveTabFromWindow(win) : undefined\r\n  }\r\n\r\n  setActiveTab(tab: Electron.WebContents) {\r\n    const win = this.tabToWindow.get(tab)\r\n    if (!win) {\r\n      throw new Error('Active tab has no parent window')\r\n    }\r\n\r\n    const prevActiveTab = this.getActiveTabFromWebContents(tab)\r\n\r\n    this.windowToActiveTab.set(win, tab)\r\n\r\n    if (tab.id !== prevActiveTab?.id) {\r\n      this.emit('active-tab-changed', tab, win)\r\n\r\n      if (typeof this.impl.selectTab === 'function') {\r\n        this.impl.selectTab(tab, win)\r\n      }\r\n    }\r\n  }\r\n\r\n  buildMenuItems(extensionId: string, menuType: ContextMenuType): Electron.MenuItem[] {\r\n    // This function is overwritten by ContextMenusAPI\r\n    return []\r\n  }\r\n}\r\n","export function ensureSuffix (str: string = '', suffix: string = '/') {\r\n    if (str.endsWith(suffix)) return str\r\n    return str + suffix\r\n}\r\nexport function unPrefix (str: string = '', prefix: string | string[] = '/') {\r\n    const prefixes = Array.isArray(prefix) ? prefix : [prefix];\r\n\r\n    let ret = str;\r\n    prefixes.forEach(prefix => {\r\n        if (ret.startsWith(prefix)) ret = ret.slice(prefix.length)\r\n    });\r\n\r\n    return ret\r\n}","export const formatIpcName = (name: string) => `crx-${name}`","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.slice(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","/**\n * Detect Electron renderer / nwjs process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process === 'undefined' || process.type === 'renderer' || process.browser === true || process.__nwjs) {\n\tmodule.exports = require('./browser.js');\n} else {\n\tmodule.exports = require('./node.js');\n}\n","/**\n * Module dependencies.\n */\n\nconst tty = require('tty');\nconst util = require('util');\n\n/**\n * This is the Node.js implementation of `debug()`.\n */\n\nexports.init = init;\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.destroy = util.deprecate(\n\t() => {},\n\t'Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.'\n);\n\n/**\n * Colors.\n */\n\nexports.colors = [6, 2, 3, 4, 5, 1];\n\ntry {\n\t// Optional dependency (as in, doesn't need to be installed, NOT like optionalDependencies in package.json)\n\t// eslint-disable-next-line import/no-extraneous-dependencies\n\tconst supportsColor = require('supports-color');\n\n\tif (supportsColor && (supportsColor.stderr || supportsColor).level >= 2) {\n\t\texports.colors = [\n\t\t\t20,\n\t\t\t21,\n\t\t\t26,\n\t\t\t27,\n\t\t\t32,\n\t\t\t33,\n\t\t\t38,\n\t\t\t39,\n\t\t\t40,\n\t\t\t41,\n\t\t\t42,\n\t\t\t43,\n\t\t\t44,\n\t\t\t45,\n\t\t\t56,\n\t\t\t57,\n\t\t\t62,\n\t\t\t63,\n\t\t\t68,\n\t\t\t69,\n\t\t\t74,\n\t\t\t75,\n\t\t\t76,\n\t\t\t77,\n\t\t\t78,\n\t\t\t79,\n\t\t\t80,\n\t\t\t81,\n\t\t\t92,\n\t\t\t93,\n\t\t\t98,\n\t\t\t99,\n\t\t\t112,\n\t\t\t113,\n\t\t\t128,\n\t\t\t129,\n\t\t\t134,\n\t\t\t135,\n\t\t\t148,\n\t\t\t149,\n\t\t\t160,\n\t\t\t161,\n\t\t\t162,\n\t\t\t163,\n\t\t\t164,\n\t\t\t165,\n\t\t\t166,\n\t\t\t167,\n\t\t\t168,\n\t\t\t169,\n\t\t\t170,\n\t\t\t171,\n\t\t\t172,\n\t\t\t173,\n\t\t\t178,\n\t\t\t179,\n\t\t\t184,\n\t\t\t185,\n\t\t\t196,\n\t\t\t197,\n\t\t\t198,\n\t\t\t199,\n\t\t\t200,\n\t\t\t201,\n\t\t\t202,\n\t\t\t203,\n\t\t\t204,\n\t\t\t205,\n\t\t\t206,\n\t\t\t207,\n\t\t\t208,\n\t\t\t209,\n\t\t\t214,\n\t\t\t215,\n\t\t\t220,\n\t\t\t221\n\t\t];\n\t}\n} catch (error) {\n\t// Swallow - we only care if `supports-color` is available; it doesn't have to be.\n}\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\n\nexports.inspectOpts = Object.keys(process.env).filter(key => {\n\treturn /^debug_/i.test(key);\n}).reduce((obj, key) => {\n\t// Camel-case\n\tconst prop = key\n\t\t.substring(6)\n\t\t.toLowerCase()\n\t\t.replace(/_([a-z])/g, (_, k) => {\n\t\t\treturn k.toUpperCase();\n\t\t});\n\n\t// Coerce string value into JS value\n\tlet val = process.env[key];\n\tif (/^(yes|on|true|enabled)$/i.test(val)) {\n\t\tval = true;\n\t} else if (/^(no|off|false|disabled)$/i.test(val)) {\n\t\tval = false;\n\t} else if (val === 'null') {\n\t\tval = null;\n\t} else {\n\t\tval = Number(val);\n\t}\n\n\tobj[prop] = val;\n\treturn obj;\n}, {});\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\n\nfunction useColors() {\n\treturn 'colors' in exports.inspectOpts ?\n\t\tBoolean(exports.inspectOpts.colors) :\n\t\ttty.isatty(process.stderr.fd);\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\tconst {namespace: name, useColors} = this;\n\n\tif (useColors) {\n\t\tconst c = this.color;\n\t\tconst colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c);\n\t\tconst prefix = `  ${colorCode};1m${name} \\u001B[0m`;\n\n\t\targs[0] = prefix + args[0].split('\\n').join('\\n' + prefix);\n\t\targs.push(colorCode + 'm+' + module.exports.humanize(this.diff) + '\\u001B[0m');\n\t} else {\n\t\targs[0] = getDate() + name + ' ' + args[0];\n\t}\n}\n\nfunction getDate() {\n\tif (exports.inspectOpts.hideDate) {\n\t\treturn '';\n\t}\n\treturn new Date().toISOString() + ' ';\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\n\nfunction log(...args) {\n\treturn process.stderr.write(util.format(...args) + '\\n');\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\tif (namespaces) {\n\t\tprocess.env.DEBUG = namespaces;\n\t} else {\n\t\t// If you set a process.env field to null or undefined, it gets cast to the\n\t\t// string 'null' or 'undefined'. Just delete instead.\n\t\tdelete process.env.DEBUG;\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n\treturn process.env.DEBUG;\n}\n\n/**\n * Init logic for `debug` instances.\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n\tdebug.inspectOpts = {};\n\n\tconst keys = Object.keys(exports.inspectOpts);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tdebug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n */\n\nformatters.o = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts)\n\t\t.split('\\n')\n\t\t.map(str => str.trim())\n\t\t.join(' ');\n};\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n */\n\nformatters.O = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts);\n};\n","'use strict';\nmodule.exports = (flag, argv) => {\n\targv = argv || process.argv;\n\tconst prefix = flag.startsWith('-') ? '' : (flag.length === 1 ? '-' : '--');\n\tconst pos = argv.indexOf(prefix + flag);\n\tconst terminatorPos = argv.indexOf('--');\n\treturn pos !== -1 && (terminatorPos === -1 ? true : pos < terminatorPos);\n};\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","'use strict';\nconst os = require('os');\nconst hasFlag = require('has-flag');\n\nconst env = process.env;\n\nlet forceColor;\nif (hasFlag('no-color') ||\n\thasFlag('no-colors') ||\n\thasFlag('color=false')) {\n\tforceColor = false;\n} else if (hasFlag('color') ||\n\thasFlag('colors') ||\n\thasFlag('color=true') ||\n\thasFlag('color=always')) {\n\tforceColor = true;\n}\nif ('FORCE_COLOR' in env) {\n\tforceColor = env.FORCE_COLOR.length === 0 || parseInt(env.FORCE_COLOR, 10) !== 0;\n}\n\nfunction translateLevel(level) {\n\tif (level === 0) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\tlevel,\n\t\thasBasic: true,\n\t\thas256: level >= 2,\n\t\thas16m: level >= 3\n\t};\n}\n\nfunction supportsColor(stream) {\n\tif (forceColor === false) {\n\t\treturn 0;\n\t}\n\n\tif (hasFlag('color=16m') ||\n\t\thasFlag('color=full') ||\n\t\thasFlag('color=truecolor')) {\n\t\treturn 3;\n\t}\n\n\tif (hasFlag('color=256')) {\n\t\treturn 2;\n\t}\n\n\tif (stream && !stream.isTTY && forceColor !== true) {\n\t\treturn 0;\n\t}\n\n\tconst min = forceColor ? 1 : 0;\n\n\tif (process.platform === 'win32') {\n\t\t// Node.js 7.5.0 is the first version of Node.js to include a patch to\n\t\t// libuv that enables 256 color output on Windows. Anything earlier and it\n\t\t// won't work. However, here we target Node.js 8 at minimum as it is an LTS\n\t\t// release, and Node.js 7 is not. Windows 10 build 10586 is the first Windows\n\t\t// release that supports 256 colors. Windows 10 build 14931 is the first release\n\t\t// that supports 16m/TrueColor.\n\t\tconst osRelease = os.release().split('.');\n\t\tif (\n\t\t\tNumber(process.versions.node.split('.')[0]) >= 8 &&\n\t\t\tNumber(osRelease[0]) >= 10 &&\n\t\t\tNumber(osRelease[2]) >= 10586\n\t\t) {\n\t\t\treturn Number(osRelease[2]) >= 14931 ? 3 : 2;\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tif ('CI' in env) {\n\t\tif (['TRAVIS', 'CIRCLECI', 'APPVEYOR', 'GITLAB_CI'].some(sign => sign in env) || env.CI_NAME === 'codeship') {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn min;\n\t}\n\n\tif ('TEAMCITY_VERSION' in env) {\n\t\treturn /^(9\\.(0*[1-9]\\d*)\\.|\\d{2,}\\.)/.test(env.TEAMCITY_VERSION) ? 1 : 0;\n\t}\n\n\tif (env.COLORTERM === 'truecolor') {\n\t\treturn 3;\n\t}\n\n\tif ('TERM_PROGRAM' in env) {\n\t\tconst version = parseInt((env.TERM_PROGRAM_VERSION || '').split('.')[0], 10);\n\n\t\tswitch (env.TERM_PROGRAM) {\n\t\t\tcase 'iTerm.app':\n\t\t\t\treturn version >= 3 ? 3 : 2;\n\t\t\tcase 'Apple_Terminal':\n\t\t\t\treturn 2;\n\t\t\t// No default\n\t\t}\n\t}\n\n\tif (/-256(color)?$/i.test(env.TERM)) {\n\t\treturn 2;\n\t}\n\n\tif (/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM)) {\n\t\treturn 1;\n\t}\n\n\tif ('COLORTERM' in env) {\n\t\treturn 1;\n\t}\n\n\tif (env.TERM === 'dumb') {\n\t\treturn min;\n\t}\n\n\treturn min;\n}\n\nfunction getSupportLevel(stream) {\n\tconst level = supportsColor(stream);\n\treturn translateLevel(level);\n}\n\nmodule.exports = {\n\tsupportsColor: getSupportLevel,\n\tstdout: getSupportLevel(process.stdout),\n\tstderr: getSupportLevel(process.stderr)\n};\n","module.exports = require(\"electron\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"node:path\");","module.exports = require(\"node:url\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"tty\");","module.exports = require(\"util\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './browser'\r\n"],"names":["Menu","MenuItem","protocol","nativeImage","app","PopupView","getExtensionUrl","getExtensionManifest","getIconPath","resolveExtensionPath","matchSize","ResizeType","debug","require","isReady","registerSchemesAsPrivileged","scheme","privileges","bypassCSP","getBrowserActionDefaults","extension","manifest","browser_action","action","title","default_title","name","iconPath","icon","path","default_popup","popup","BrowserActionAPI","constructor","ctx","actionMap","Map","observers","Set","queuedUpdate","handleCrxRequest","request","callback","url","response","URL","hostname","requestType","tabId","searchParams","get","fragments","pathname","split","extensionId","imageSize","parseInt","resizeType","Up","session","getExtension","iconDetails","tabs","iconImage","iconAbsPath","createFromPath","imagePath","imageData","createFromDataURL","undefined","statusCode","mimeType","data","toPNG","e","console","error","handle","router","apiHandler","getter","propName","details","getAction","id","result","setDetails","value","defaults","valueObj","tabAction","Object","assign","onUpdate","setter","event","handleProp","prop","key","iconModified","Date","now","preloadOpts","allowRemote","extensionContext","getState","bind","activate","sender","webContents","add","once","delete","store","on","actionDetails","setupSession","processExtension","removeActions","registerBufferProtocol","set","has","getPopupUrl","popupPath","defaultAction","actions","Array","from","entries","map","rest","tabsInfo","keys","activeTab","getActiveTabOfCurrentWindow","activeTabId","extEvt","eventType","activateClick","activateContextMenu","anchorRect","toggleExtension","isDestroyed","destroy","tab","getTabById","Error","popupUrl","win","tabToWindow","parent","emit","tabDetails","tabDetailsCache","sendEvent","menu","append","opts","appendSeparator","type","label","click","homePageUrl","homepage_url","createTab","contextMenuItems","buildMenuItems","length","forEach","item","optionsPage","options_page","options_ui","page","optionsPageUrl","enabled","x","Math","floor","y","height","queueMicrotask","size","observer","send","CommandsAPI","getAll","promises","fs","uri","href","relpath","indexOf","slice","resPath","join","startsWith","validateExtensionResource","stat","imageSet","match","first","pop","iconSize","icons","default_icon","getIconImage","iconAbsolutePath","escapePattern","pattern","replace","matchesPattern","regexp","RegExp","DEFAULT_CONTEXTS","getContextTypesFromParams","params","contexts","mediaType","pageURL","linkURL","frameURL","selectionText","isEditable","formatTitle","includes","matchesConditions","props","conditions","visible","contextTypes","targetUrl","documentUrl","inContext","some","context","targetUrlPatterns","documentUrlPatterns","ContextMenusAPI","menus","buildMenuItem","showIcon","resize","width","menuItemOptions","onClicked","buildMenuItemsFromTemplate","menuItemTemplates","itemMap","menuItem","parentId","parentMenuItem","submenu","push","menuItems","buildFromTemplate","isArray","create","createProperties","addContextItem","remove","menuItemId","items","removeAll","buildMenuItemsForExtension","contextItems","buildMenuItemsForParams","srcURL","propItems","menuType","extensionItems","checked","frameId","frameUrl","editable","wasChecked","pageUrl","linkUrl","parentMenuItemId","srcUrl","CookieStoreID","onChangedCauseTranslation","createCookieDetails","cookie","domain","hostOnly","Boolean","httpOnly","secure","storeId","Default","CookiesAPI","cookies","onChanged","cause","removed","changeInfo","broadcastEvent","getAllCookieStores","addListener","tabIds","filter","Notification","TemplateType","getBody","Basic","List","message","getUrgency","priority","createScopedIdentifier","stripScopeFromIdentifier","index","substr","NotificationsAPI","registry","clear","notificationId","close","arg1","arg2","iconUrl","notification","subtitle","body","silent","urgency","timeoutType","requireInteraction","byUser","show","getPermissionLevel","isSupported","update","EventEmitter","RuntimeAPI","openOptionsPage","active","parse","BrowserWindow","ensureSuffix","WindowsAPI","TabsAPI","getAllInWindow","getCurrent","insertCSS","query","reload","goForward","goBack","observeTab","updateEvents","updateHandler","onUpdated","eventName","faviconHandler","favicons","favicon","off","removeTab","onRemoved","onCreated","onActivated","getType","getURL","createTabDetails","getActiveTabFromWebContents","getSize","audible","isCurrentlyAudible","autoDiscardable","discarded","favIconUrl","highlighted","incognito","mutedInfo","muted","audioMuted","pinned","selected","status","isLoading","getTitle","windowId","impl","assignTabDetails","getTabDetails","TAB_ID_NONE","WINDOW_ID_CURRENT","lastFocusedWindowId","browserWindow","urlInfo","baseURL","posix","code","info","isSet","lastFocusedWindow","getLastFocusedWindow","currentWin","windowsGetCurrent","filteredTabs","currentWindow","reloadProperties","bypassCache","reloadIgnoringCache","updateProperties","loadURL","setAudioMuted","ids","prevDetails","compareProps","didUpdate","WINDOW_ID_NONE","getAllWindows","find","isWindowClosing","activeChanged","setActiveTab","tabInfo","cacheTabId","electron","getFrame","frameProcessId","frameRoutingId","webFrameMain","fromId","getFrameId","frame","top","frameTreeNodeId","getParentFrameId","parentFrame","getFrameDetails","errorOccurred","processId","parentFrameId","WebNavigationAPI","sendNavigationEvent","onCreatedNavigationTarget","isInPlace","isMainFrame","sourceTabId","sourceProcessId","sourceFrameId","timeStamp","onBeforeNavigate","onCommitted","httpResponseCode","httpStatusText","onHistoryStateUpdated","transitionType","transitionQualifiers","onDOMContentLoaded","isLoadingMainFrame","onFinishLoad","getAllFrames","mainFrame","targetFrame","framesInSubtree","unPrefix","getWindowState","isMaximized","isMinimized","isFullScreen","getLastFocused","observeWindow","window","onFocus","onFocusChanged","onClosed","windowDetailsCache","removeWindow","onRestoreOrMove","getWindowDetails","state","onMinimize","onMaximize","onEnterFullscreen","onLeaveFullscreen","process","platform","createWindowDetails","focused","isFocused","getPosition","left","ownerWindow","isPersistent","alwaysOnTop","isAlwaysOnTop","sessionId","getWindowFromId","getWindowById","windows","createWindow","maximize","minimize","fullScreenable","setFullScreen","warn","restore","removedWindowId","findWindowById","windowDetails","electronSession","ExtensionStore","ExtensionRouter","sessionMap","WeakMap","ElectronChromeExtensions","fromSession","modulePath","preloadPath","api","defaultSession","__dirname","browserAction","contextMenus","commands","notifications","runtime","webNavigation","prependPreload","preloads","getPreloads","preloadIndex","splice","setPreloads","preloadExists","isFile","addTab","addWindow","selectTab","addExtensionHost","host","getContextMenuItems","addExtension","removeExtension","Extensions","destroyed","usingPreferredSize","readyPromise","isDevToolsOpened","closeDevTools","maybeClose","getFocusedWindow","updatePreferredSize","setSize","updatePosition","movable","maximizable","minimizable","resizable","skipTaskbar","backgroundColor","webPreferences","sandbox","nodeIntegration","nodeIntegrationInWorker","nativeWindowOpen","worldSafeExecuteJavaScript","contextIsolation","enablePreferredSizeMode","untypedWebContents","load","BOUNDS","maxWidth","maxHeight","Promise","resolve","setTimeout","queryPreferredSize","whenReady","rect","min","max","minWidth","minHeight","setBounds","getBounds","winBounds","viewBounds","POSITION_PADDING","executeJavaScript","document","getBoundingClientRect","ipcMain","createDebug","formatIpcName","shortenValues","k","v","formatters","r","JSON","stringify","DEFAULT_SESSION","gRoutingDelegate","RoutingDelegate","onRouterMessage","handlerName","args","onExtensionMessage","onRemoteMessage","sessionPartition","ses","fromPartition","onAddListener","listener","onRemoveListener","removeListener","addObserver","eventListenerEquals","eventListener","other","delegate","handlers","listeners","extensionHosts","filterListeners","predicate","filteredListeners","delta","observeListenerHost","eventListeners","existingEventListener","findIndex","getHandler","handler","extEvent","el","windowToActiveTab","foundWindow","wc","fromWebContents","behaviors","getTabbedBrowserWindowBehavior","windowHasTabs","keepRefWindowOnAllTabsClosed","getActiveTabFromWindow","prevActiveTab","str","suffix","endsWith","prefix","prefixes","ret"],"sourceRoot":""}